<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cmswe.alumni.search.mapper.SearchSuggestionMapper">

    <!-- 根据前缀查询建议词（按权重倒序） -->
    <select id="selectByPrefix" resultType="com.cmswe.alumni.common.entity.SearchSuggestion">
        SELECT * FROM search_suggestion
        WHERE keyword LIKE CONCAT(#{prefix}, '%')
          AND search_type = #{searchType}
          AND status = 1
          AND is_delete = 0
        ORDER BY weight DESC, created_time DESC
        LIMIT #{limit}
    </select>

    <!-- 查询所有启用的建议词（按权重倒序） -->
    <select id="selectEnabled" resultType="com.cmswe.alumni.common.entity.SearchSuggestion">
        SELECT * FROM search_suggestion
        WHERE search_type = #{searchType}
          AND status = 1
          AND is_delete = 0
        ORDER BY weight DESC, created_time DESC
        LIMIT #{limit}
    </select>

    <!-- 更新权重 -->
    <update id="updateWeight">
        UPDATE search_suggestion
        SET weight = #{weight},
            updated_time = CURRENT_TIMESTAMP
        WHERE id = #{id}
    </update>

    <!-- 批量更新状态 -->
    <update id="batchUpdateStatus">
        UPDATE search_suggestion
        SET status = #{status},
            updated_time = CURRENT_TIMESTAMP
        WHERE id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

</mapper>
