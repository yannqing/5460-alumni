<!--pages/article-publish/index/index.wxml-->
<!-- 自定义导航栏 -->
<custom-nav-bar showBack="{{true}}" useAuditStyle="{{true}}" auditTitle="发布文章">
<scroll-view class="scroll-container" scroll-y enable-back-to-top>
<view class="article-publish-page">
  <!-- 标题输入 -->
  <view class="form-item">
    <input 
      class="title-input" 
      placeholder="请输入文章标题" 
      placeholder-class="placeholder" 
      value="{{title}}"
      bindinput="onTitleInput"
      maxlength="100"
    />
  </view>

  <!-- 封面图选择 -->
  <view class="form-item">
    <view class="section-title">封面图</view>
    <view class="cover-image-container" bindtap="chooseCoverImage">
      <image 
        class="cover-image" 
        src="{{coverImage || '/images/default-cover.png'}}" 
        mode="aspectFill"
      ></image>
      <view class="add-cover-icon">+</view>
    </view>
    <view class="tip-text">点击上传封面图</view>
  </view>

  <!-- 内容输入 -->
  <view class="form-item">
    <view class="section-title">文章描述</view>
    <textarea 
      class="content-textarea" 
      placeholder="请输入文章描述" 
      placeholder-class="placeholder" 
      value="{{content}}"
      bindinput="onContentInput"
      maxlength="5000"
      auto-height
    ></textarea>
  </view>

  <!-- 文章链接输入 -->
  <view class="form-item">
    <view class="section-title">文章链接</view>
    <input 
      class="link-input" 
      placeholder="请输入文章链接（必填）" 
      placeholder-class="placeholder" 
      value="{{articleLink}}"
      bindinput="onArticleLinkInput"
      maxlength="500"
      type="text"
    />
  </view>



  <!-- 是否在首页展示 -->
  <view class="form-item">
    <view class="section-title">是否在首页展示</view>
    <radio-group class="radio-group" bindchange="onShowOnHomepageChange">
      <label class="radio-item" wx:for="{{showOnHomepageOptions}}" wx:key="value">
        <radio value="{{item.value}}" checked="{{showOnHomepage === item.value}}" />
        <text class="radio-label">{{item.label}}</text>
      </label>
    </radio-group>
  </view>

  <!-- 发布者类型选择 -->
  <view class="form-item">
    <view class="section-title">发布者类型</view>
    <radio-group class="radio-group" bindchange="onPublishTypeChange">
      <label class="radio-item" wx:for="{{publishTypes}}" wx:key="value">
        <radio value="{{item.value}}" checked="{{publishType == item.value}}" />
        <text class="radio-label">{{item.label}}</text>
      </label>
    </radio-group>
  </view>

  <!-- 发布者选择 -->
  <view class="form-item">
    <view class="section-title">选择发布者</view>
    <view class="publisher-selector" bindtap="showPublisherSelector">
      <text class="selector-label">{{selectedPublisherName || '请选择发布者'}}</text>
      <text class="selector-arrow">▼</text>
    </view>
  </view>

  <!-- 子文章管理 -->
  <view class="form-item">
    <view class="section-title">
      <text>子文章</text>
    </view>
    
    <!-- 子文章列表 -->
    <view class="child-articles-list">
      <view class="child-article-item" wx:for="{{childArticles}}" wx:key="index">
        <view class="child-article-header">
          <text class="child-article-title">子文章 {{index + 1}}</text>
          <button class="delete-child-article-btn" bindtap="deleteChildArticle" data-index="{{index}}">删除</button>
        </view>
        
        <!-- 子文章标题 -->
        <view class="form-item">
          <input 
            class="title-input" 
            placeholder="请输入子文章标题" 
            placeholder-class="placeholder" 
            value="{{item.articleTitle}}"
            bindinput="onChildArticleInput" 
            data-index="{{index}}" 
            data-field="articleTitle"
            maxlength="100"
          />
        </view>

        <!-- 子文章封面图选择 -->
        <view class="form-item">
          <view class="section-title">封面图</view>
          <view class="cover-image-container" bindtap="chooseChildArticleCoverImage" data-index="{{index}}">
            <image 
              class="cover-image" 
              src="{{item.coverImage || '/images/default-cover.png'}}" 
              mode="aspectFill"
            ></image>
            <view class="add-cover-icon">+</view>
          </view>
          <view class="tip-text">点击上传封面图</view>
        </view>
        
        <!-- 子文章链接 -->
        <view class="form-item">
          <view class="section-title">文章链接</view>
          <input 
            class="link-input" 
            placeholder="请输入子文章链接" 
            placeholder-class="placeholder" 
            value="{{item.articleLink}}"
            bindinput="onChildArticleInput" 
            data-index="{{index}}" 
            data-field="articleLink"
            maxlength="500"
            type="text"
          />
        </view>
        
        <!-- 子文章描述 -->
        <view class="form-item">
          <view class="section-title">文章描述</view>
          <textarea 
            class="content-textarea" 
            placeholder="请输入子文章描述" 
            placeholder-class="placeholder" 
            value="{{item.description}}"
            bindinput="onChildArticleInput" 
            data-index="{{index}}" 
            data-field="description"
            maxlength="5000"
            auto-height
          ></textarea>
        </view>
      </view>
      
      <view class="empty-child-articles" wx:if="{{childArticles.length === 0}}">
        <text>暂无子文章，点击添加按钮添加</text>
      </view>
      
      <!-- 添加子文章按钮 -->
      <button class="add-child-article-btn" bindtap="addChildArticle">添加子文章</button>
    </view>
  </view>

  <!-- 发布者选择器弹窗 -->
  <view class="publisher-picker" wx:if="{{showPublisherPicker}}">
    <view class="picker-overlay" bindtap="cancelPublisherSelect"></view>
    <view class="picker-content">
      <view class="picker-header">
        <text class="picker-title">选择发布者</text>
        <text class="picker-cancel" bindtap="cancelPublisherSelect">取消</text>
      </view>
      <view class="picker-list">
        <view
          class="picker-item"
          wx:for="{{publisherList}}"
          wx:key="id"
          data-publisher-id="{{item.id}}"
          data-publisher-name="{{item.name}}"
          bindtap="selectPublisher"
        >
          <view class="publisher-info">
            <image 
              wx:if="{{item.avatar}}" 
              src="{{item.avatar}}" 
              class="publisher-avatar" 
              mode="aspectFill" 
            />
            <image 
              wx:else 
              src="{{defaultUserAvatarUrl}}" 
              class="publisher-avatar" 
              mode="aspectFill" 
            />
            <view class="name-with-quota">
              <text class="item-name">{{item.name}}</text>
              <text class="quota-count" wx:if="{{showOnHomepage === 1}}">（{{item.monthlyHomepageArticleQuota}}）</text>
            </view>
          </view>
          <text class="item-check" wx:if="{{selectedPublisherId == item.id}}">✓</text>
        </view>
        <view class="picker-empty" wx:if="{{publisherList.length === 0}}">
          <text>暂无可用的发布者数据</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 发布按钮 -->
  <view class="publish-btn-container">
    <button class="publish-btn" bindtap="publishArticle">发布文章</button>
  </view>
</view>
</scroll-view>
</custom-nav-bar>
