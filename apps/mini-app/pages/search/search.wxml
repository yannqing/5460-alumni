<!--pages/search/search.wxml-->
<!-- æ¶ˆæ¯é€šçŸ¥ç»„ä»¶ -->
<message-notification />

<view class="container">
  <!-- æœç´¢æ¡† -->
  <view class="search-bar">
    <!-- è¿”å›æŒ‰é’®ï¼ˆä»…åœ¨æ˜¾ç¤ºæœç´¢ç»“æœæ—¶æ˜¾ç¤ºï¼‰ -->
    <view wx:if="{{showResult}}" class="back-button" catchtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    
    <view class="search-input-wrap {{showResult ? 'with-back' : ''}}">
      <input class="search-input" type="text" placeholder="æœç´¢æ¯æ ¡ã€æ ¡å‹ä¼šã€æ ¡å‹" value="{{keyword}}" bindinput="onSearchInput" bindconfirm="onSearch" focus="{{!showResult}}" />
      <view class="search-actions">
        <image class="scan-btn-icon" src="{{iconScan}}" mode="aspectFit" bindtap="scanCode" />
        <image class="search-btn" src="{{iconSearch}}" mode="aspectFit" bindtap="onSearch" />
      </view>
    </view>
  </view>

  <!-- æœç´¢å‰æ˜¾ç¤º -->
  <view wx:if="{{!showResult}}">
    <!-- çƒ­é—¨æœç´¢ -->
    <view class="section card">
      <view class="section-title-small">çƒ­é—¨æœç´¢</view>
      <view class="tag-list">
        <view class="tag" wx:for="{{hotSearchList}}" wx:key="*this" bindtap="onHotSearchTap" data-keyword="{{item}}">
          {{item}}
        </view>
      </view>
    </view>

    <!-- æœç´¢å†å² -->
    <view wx:if="{{searchHistory.length > 0}}" class="section card">
      <view class="flex-between mb-20">
        <view class="section-title-small">æœç´¢å†å²</view>
        <view class="text-placeholder" bindtap="clearHistory">æ¸…ç©º</view>
      </view>
      <view class="history-list">
        <view class="history-item" wx:for="{{searchHistory}}" wx:key="*this" bindtap="onHistoryTap" data-keyword="{{item}}">
          <text class="history-icon">ğŸ•</text>
          <text class="history-text">{{item}}</text>
        </view>
      </view>
    </view>



    <!-- æœç´¢æ¦œå• -->
    <view class="section card">
      <view class="section-title-small">æœç´¢æ¦œå•</view>
      <view class="ranking-list">
        <view class="ranking-item" wx:for="{{searchRankingList}}" wx:key="rank" bindtap="onRankingTap" data-keyword="{{item.keyword}}">
          <view class="rank-number {{item.rank <= 3 ? 'top-rank' : ''}}">{{item.rank}}</view>
          <view class="rank-content">
            <text class="rank-keyword">{{item.keyword}}</text>
            <text class="rank-icon" wx:if="{{item.hot}}">ğŸ”¥</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view wx:else>
    <view class="tabs">
      <view class="tab-item {{activeTab === index ? 'active' : ''}}" wx:for="{{tabs}}" wx:key="*this" bindtap="switchTab" data-index="{{index}}">
        {{item}}
      </view>
    </view>

    <!-- å…¨éƒ¨ç»“æœ -->
    <view wx:if="{{activeTab === 0}}">
      <view wx:if="{{searchResult.schools.length > 0}}" class="result-section">
        <view class="section-title-small">æ¯æ ¡</view>
        <view class="list-item" wx:for="{{searchResult.schools}}" wx:key="id" bindtap="viewSchoolDetail" data-id="{{item.id}}">
          <image class="avatar" src="{{item.icon}}" mode="aspectFill" />
          <view class="flex-1">
            <view class="text-primary text-bold">{{item.name}}</view>
            <view class="text-placeholder mt-10">{{item.location}} Â· {{item.alumniCount}}äºº</view>
          </view>
        </view>
      </view>

      <view wx:if="{{searchResult.associations.length > 0}}" class="result-section">
        <view class="section-title-small">æ ¡å‹ä¼š</view>
        <view class="list-item" wx:for="{{searchResult.associations}}" wx:key="id" bindtap="viewAssociationDetail" data-id="{{item.id}}">
          <view class="flex-1">
            <view class="text-primary text-bold">{{item.name}}</view>
            <view class="text-placeholder mt-10">{{item.location}} Â· {{item.memberCount}}äºº</view>
          </view>
        </view>
      </view>

      <view wx:if="{{searchResult.alumni.length > 0}}" class="result-section">
        <view class="section-title-small">æ ¡å‹</view>
        <view class="list-item alumni-item" wx:for="{{searchResult.alumni}}" wx:key="id" bindtap="viewAlumniDetail" data-id="{{item.id}}">
          <image class="avatar alumni-avatar" src="{{item.avatar}}" mode="aspectFill" />
          <view class="flex-1 alumni-content">
            <view class="text-primary text-bold alumni-name">{{item.name}}</view>
            <view class="text-placeholder mt-10 alumni-info">{{item.school}} {{item.company}}</view>
            <view class="text-placeholder mt-8 alumni-location">ä½ç½®ï¼š{{item.location || 'æ— '}}</view>
            <view class="text-placeholder mt-8 alumni-signature">ç­¾åï¼š{{item.signature || 'æ— '}}</view>
          </view>
        </view>
      </view>

      <view wx:if="{{searchResult.merchants.length > 0}}" class="result-section">
        <view class="section-title-small">å•†é“º</view>
        <view class="list-item" wx:for="{{searchResult.merchants}}" wx:key="id" bindtap="viewMerchantDetail" data-id="{{item.id}}">
          <image class="avatar" src="{{item.avatar}}" mode="aspectFill" />
          <view class="flex-1">
            <view class="text-primary text-bold">{{item.name}}</view>
            <view class="text-placeholder mt-10">{{item.location}} <text wx:if="{{item.rating > 0}}">Â· â­ {{item.rating}}</text></view>
          </view>
        </view>
      </view>

      <!-- ç©ºç»“æœæç¤º -->
      <view wx:if="{{searchResult.schools.length === 0 && searchResult.associations.length === 0 && searchResult.alumni.length === 0 && searchResult.merchants.length === 0}}" class="empty-result">
        <text class="empty-text">æš‚æ— æœç´¢ç»“æœ</text>
      </view>

      <!-- åŠ è½½æ›´å¤šæç¤º -->
      <view wx:if="{{loading}}" class="loading-more">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
      <view wx:if="{{!hasMore && searchResult.schools.length + searchResult.associations.length + searchResult.alumni.length + searchResult.merchants.length > 0}}" class="no-more">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>

    <!-- æ¯æ ¡ç»“æœ -->
    <view wx:if="{{activeTab === 1}}">
      <view wx:if="{{searchResult.schools.length > 0}}" class="result-section">
        <view class="list-item" wx:for="{{searchResult.schools}}" wx:key="id" bindtap="viewSchoolDetail" data-id="{{item.id}}">
          <image class="avatar" src="{{item.icon}}" mode="aspectFill" />
          <view class="flex-1">
            <view class="text-primary text-bold">{{item.name}}</view>
            <view class="text-placeholder mt-10">{{item.location}} Â· {{item.alumniCount}}äºº</view>
          </view>
        </view>
      </view>
      <view wx:else class="empty-result">
        <text class="empty-text">æš‚æ— æœç´¢ç»“æœ</text>
      </view>
    </view>

    <!-- æ ¡å‹ä¼šç»“æœ -->
    <view wx:if="{{activeTab === 2}}">
      <view wx:if="{{searchResult.associations.length > 0}}" class="result-section">
        <view class="list-item" wx:for="{{searchResult.associations}}" wx:key="id" bindtap="viewAssociationDetail" data-id="{{item.id}}">
          <view class="flex-1">
            <view class="text-primary text-bold">{{item.name}}</view>
            <view class="text-placeholder mt-10">{{item.location}} Â· {{item.memberCount}}äºº</view>
          </view>
        </view>
      </view>
      <view wx:else class="empty-result">
        <text class="empty-text">æš‚æ— æœç´¢ç»“æœ</text>
      </view>
      <!-- åŠ è½½æ›´å¤šæç¤º -->
      <view wx:if="{{loading}}" class="loading-more">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
      <view wx:if="{{!hasMore && searchResult.associations.length > 0}}" class="no-more">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>

    <!-- æ ¡å‹ç»“æœ -->
    <view wx:if="{{activeTab === 3}}">
      <view wx:if="{{searchResult.alumni.length > 0}}" class="result-section">
        <view class="list-item alumni-item" wx:for="{{searchResult.alumni}}" wx:key="id" bindtap="viewAlumniDetail" data-id="{{item.id}}">
          <image class="avatar alumni-avatar" src="{{item.avatar}}" mode="aspectFill" />
          <view class="flex-1 alumni-content">
            <view class="text-primary text-bold alumni-name">{{item.name}}</view>
            <view class="text-placeholder mt-10 alumni-info">{{item.school}} {{item.company}}</view>
            <view class="text-placeholder mt-8 alumni-location">ä½ç½®ï¼š{{item.location || 'æ— '}}</view>
            <view class="text-placeholder mt-8 alumni-signature">ç­¾åï¼š{{item.signature || 'æ— '}}</view>
          </view>
        </view>
      </view>
      <view wx:else class="empty-result">
        <text class="empty-text">æš‚æ— æœç´¢ç»“æœ</text>
      </view>
      <!-- åŠ è½½æ›´å¤šæç¤º -->
      <view wx:if="{{loading}}" class="loading-more">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
      <view wx:if="{{!hasMore && searchResult.alumni.length > 0}}" class="no-more">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>

    <!-- å•†é“ºç»“æœ -->
    <view wx:if="{{activeTab === 4}}">
      <view wx:if="{{searchResult.merchants.length > 0}}" class="result-section">
        <view class="list-item" wx:for="{{searchResult.merchants}}" wx:key="id" bindtap="viewMerchantDetail" data-id="{{item.id}}">
          <image class="avatar" src="{{item.avatar}}" mode="aspectFill" />
          <view class="flex-1">
            <view class="text-primary text-bold">{{item.name}}</view>
            <view class="text-placeholder mt-10">{{item.location}} <text wx:if="{{item.rating > 0}}">Â· â­ {{item.rating}}</text></view>
          </view>
        </view>
      </view>
      <view wx:else class="empty-result">
        <text class="empty-text">æš‚æ— æœç´¢ç»“æœ</text>
      </view>
      <!-- åŠ è½½æ›´å¤šæç¤º -->
      <view wx:if="{{loading}}" class="loading-more">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
      <view wx:if="{{!hasMore && searchResult.merchants.length > 0}}" class="no-more">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>
  </view>
</view>

