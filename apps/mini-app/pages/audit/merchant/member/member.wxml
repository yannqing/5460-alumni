<!-- pages/audit/merchant/member/member.wxml -->
<custom-nav-bar showBack="{{true}}" useAuditStyle="{{true}}" auditTitle="商家成员">
<view class="page">
  <!-- 选择商家卡片（与校友会审核页 group_5 一致） -->
  <view class="group_5" wx:if="{{showMerchantSelector}}">
    <text class="text_14">成员管理</text>
    <text class="label_text">选择商家</text>
    <view class="text-wrapper_8" bindtap="showMerchantSelector">
      <text class="text_15">{{selectedMerchantName || '请选择商家'}}</text>
    </view>
  </view>

  <!-- 成员列表卡片（与校友会审核页 group_7 一致） -->
  <view class="group_7">
    <view class="member-list-header">
      <text class="text_20">成员列表</text>
      <view class="invite-btn-wrap">
        <button class="invite-btn" bindtap="showAddMemberModal">新增成员</button>
      </view>
    </view>
    <scroll-view class="scroll-list" scroll-y enable-back-to-top show-scrollbar="{{false}}" style="height: {{scrollListHeight}}px;">
      <view class="loading-state" wx:if="{{loading}}">
        <text>加载中...</text>
      </view>
      <view class="empty-block" wx:elif="{{memberList && memberList.length === 0}}">
        <text class="empty-text">暂无成员数据</text>
      </view>
      <view class="member-list" wx:else>
        <view class="member-item" wx:for="{{memberList}}" wx:key="id">
          <view class="member-header">
            <image class="member-avatar" src="{{item.avatarUrl || '../../../../assets/avatar/default_avatar.jpeg'}}" mode="aspectFill"></image>
            <view class="member-info">
              <view class="member-name-row">
                <text class="member-name">{{item.nickname || item.name || '未知'}}</text>
                <text class="member-real-name">({{item.name || '未设置'}})</text>
              </view>
              <view class="member-role">{{item.roleName || '普通成员'}}</view>
            </view>
          </view>
          <view class="member-details">
            <view class="member-detail-item">
              <text class="detail-label">店铺：</text>
              <text class="detail-value">{{item.shopName || '未分配'}}</text>
            </view>
            <view class="member-detail-item">
              <text class="detail-label">加入时间：</text>
              <text class="detail-value">{{item.joinTime ? item.joinTime.split('T')[0] : '未知'}}</text>
            </view>
            <view class="member-detail-item">
              <text class="detail-label">状态：</text>
              <text class="detail-value status-{{item.status === 1 ? 'active' : 'inactive'}}">{{item.status === 1 ? '正常' : '禁用'}}</text>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 新增成员弹窗 -->
  <view class="modal-overlay" wx:if="{{showAddModal}}" bindtap="hideAddMemberModal"></view>
  <view class="modal-container" wx:if="{{showAddModal}}">
    <view class="modal-header">
      <text class="modal-title">新增成员</text>
      <view class="modal-close" bindtap="hideAddMemberModal">×</view>
    </view>
    <view class="modal-content">
      <form bindsubmit="submitAddMember">
        <view class="form-item">
          <text class="form-label">校友用户ID <text class="required">*</text></text>
          <input class="form-input" name="wxId" placeholder="请输入校友用户ID" value="{{addForm.wxId}}" bindinput="onAddFormInput" data-field="wxId" type="number" />
        </view>
        <view class="form-item">
          <text class="form-label">店铺ID</text>
          <input class="form-input" name="shopId" placeholder="请输入店铺ID（可选）" value="{{addForm.shopId}}" bindinput="onAddFormInput" data-field="shopId" type="number" />
        </view>
        <view class="form-item">
          <text class="form-label">角色ID <text class="required">*</text></text>
          <input class="form-input" name="roleOrId" placeholder="请输入角色ID" value="{{addForm.roleOrId}}" bindinput="onAddFormInput" data-field="roleOrId" type="number" />
        </view>
        <view class="form-actions">
          <button class="btn-cancel" bindtap="hideAddMemberModal">取消</button>
          <button class="btn-submit" form-type="submit" loading="{{submitting}}">提交</button>
        </view>
      </form>
    </view>
  </view>

  <!-- 商户选择器弹窗（与校友会审核页 picker 一致） -->
  <view class="merchant-picker" wx:if="{{showMerchantPicker}}">
    <view class="picker-overlay" bindtap="cancelMerchantSelect"></view>
    <view class="picker-content">
      <view class="picker-header">
        <text class="picker-title">选择商户</text>
        <text class="picker-cancel" bindtap="cancelMerchantSelect">取消</text>
      </view>
      <view class="picker-list">
        <view class="picker-item" wx:for="{{merchantList}}" wx:key="merchantId" data-merchant-id="{{item.merchantId + ''}}" data-merchant-name="{{item.merchantName}}" bindtap="selectMerchant">
          <text class="item-name">{{item.merchantName}}</text>
          <text class="item-check" wx:if="{{selectedMerchantId == item.merchantId}}">✓</text>
        </view>
        <view class="picker-empty" wx:if="{{merchantList.length === 0}}">
          <text>暂无商户数据</text>
        </view>
      </view>
    </view>
  </view>
</view>
</custom-nav-bar>
