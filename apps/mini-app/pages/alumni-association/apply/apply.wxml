<custom-nav-bar useAuditStyle="{{true}}" auditTitle="申请加入校友会" showBack="{{true}}">
  <view class="white-background-content">
    <view class="container" bindtap="closeAllDropdowns">
  <image src="https://${API_DOMAIN}/upload/images/2026/02/09/9f328fe3-fcad-4019-a379-1a6db70f3a5d.png" class="header-image" mode="aspectFit"></image>

    <!-- 基本信息 -->
    <view class="form-section">
      <view class="section-title">基本信息</view>

      <view class="form-item required">
        <view class="form-label">真实姓名</view>
        <input
          class="form-input"
          placeholder="请输入真实姓名"
          value="{{formData.name}}"
          bindinput="handleInput"
          data-field="name"
          maxlength="20"
          disabled="{{mode === 'view'}}"
        />
      </view>

      <view class="form-item required">
        <view class="form-label">身份证号</view>
        <input
          class="form-input"
          placeholder="请输入身份证号"
          value="{{formData.identifyCode}}"
          bindinput="handleInput"
          data-field="identifyCode"
          maxlength="18"
          disabled="{{mode === 'view'}}"
        />
      </view>

      <view class="form-item">
        <view class="form-label">手机号</view>
        <input
          class="form-input"
          type="number"
          placeholder="请输入手机号"
          value="{{formData.phone}}"
          bindinput="handleInput"
          data-field="phone"
          maxlength="11"
          disabled="{{mode === 'view'}}"
        />
      </view>

      <view class="form-item">
        <view class="form-label">申请理由</view>
        <textarea
          class="form-textarea"
          placeholder="请简要说明申请理由（选填）"
          value="{{formData.applicationReason}}"
          bindinput="handleInput"
          data-field="applicationReason"
          maxlength="200"
          disabled="{{mode === 'view'}}"
        />
      </view>
    </view>

    <!-- 教育经历 -->
    <view class="form-section">
      <view class="section-title">教育经历（必填）</view>

      <view wx:if="{{schoolName}}" class="form-item">
        <view class="form-label">学校</view>
        <view class="form-display">{{schoolName}}</view>
      </view>

      <view class="form-item required">
        <view class="form-label">入学年份</view>
        <picker
          mode="date"
          fields="year"
          value="{{formData.enrollmentYear ? formData.enrollmentYear + '-01-01' : ''}}"
          bindchange="handleYearChange"
          data-field="enrollmentYear"
          disabled="{{mode === 'view'}}"
        >
          <view class="form-picker {{mode === 'view' ? 'disabled' : ''}}">
            {{formData.enrollmentYear || '请选择入学年份'}}
          </view>
        </picker>
      </view>

      <view class="form-item required">
        <view class="form-label">毕业年份</view>
        <picker
          mode="date"
          fields="year"
          value="{{formData.graduationYear ? formData.graduationYear + '-01-01' : ''}}"
          bindchange="handleYearChange"
          data-field="graduationYear"
          disabled="{{mode === 'view'}}"
        >
          <view class="form-picker {{mode === 'view' ? 'disabled' : ''}}">
            {{formData.graduationYear || '请选择毕业年份'}}
          </view>
        </picker>
      </view>

      <view class="form-item required">
        <view class="form-label">院系</view>
        <input
          class="form-input"
          placeholder="请输入院系"
          value="{{formData.department}}"
          bindinput="handleInput"
          data-field="department"
          maxlength="50"
          disabled="{{mode === 'view'}}"
        />
      </view>

      <view class="form-item required">
        <view class="form-label">专业</view>
        <input
          class="form-input"
          placeholder="请输入专业"
          value="{{formData.major}}"
          bindinput="handleInput"
          data-field="major"
          maxlength="50"
          disabled="{{mode === 'view'}}"
        />
      </view>

      <view class="form-item required">
        <view class="form-label">班级</view>
        <input
          class="form-input"
          placeholder="请输入班级"
          value="{{formData.className}}"
          bindinput="handleInput"
          data-field="className"
          maxlength="50"
          disabled="{{mode === 'view'}}"
        />
      </view>

      <view class="form-item required">
        <view class="form-label">学历层次</view>
        <picker
          mode="selector"
          range="{{educationLevels}}"
          value="{{educationLevelIndex}}"
          bindchange="handleEducationLevelChange"
          disabled="{{mode === 'view'}}"
        >
          <view class="form-picker {{mode === 'view' ? 'disabled' : ''}}">
            {{formData.educationLevel || '请选择学历层次'}}
          </view>
        </picker>
      </view>
    </view>

    <!-- 附件上传 -->
    <view class="form-section">
      <view class="section-title">相关材料（选填）</view>
      <view class="upload-container">
        <!-- 图片列表 -->
        <view class="image-list">
          <view class="image-item" wx:for="{{attachments}}" wx:key="index">
            <image class="list-image" src="{{item.url}}" mode="aspectFill"></image>
            <!-- 删除按钮 -->
            <view wx:if="{{mode === 'edit'}}" class="image-delete-btn" bindtap="deleteAttachment" data-index="{{index}}">
              <text class="delete-icon">×</text>
            </view>
          </view>
          
          <!-- 上传按钮 -->
          <view wx:if="{{mode === 'edit' && attachments.length < 3}}" class="upload-btn" bindtap="chooseImage">
            <text class="upload-icon">+</text>
            <text class="upload-text">{{attachments.length > 0 ? '继续上传' : '上传图片'}}</text>
          </view>
        </view>
        
        <!-- 图片数量提示 -->
        <text wx:if="{{mode === 'edit'}}" class="image-count">{{attachments.length}}/3</text>
      </view>
    </view>

    <!-- 按钮区域 -->
    <view class="form-actions">
      <!-- 编辑模式：显示提交按钮 -->
      <button wx:if="{{mode === 'edit'}}" class="submit-button" bindtap="submitApplication" disabled="{{submitting}}">
        {{submitting ? '提交中...' : '提交申请'}}
      </button>

      <!-- 查看模式：显示撤销和编辑按钮 -->
      <view wx:if="{{mode === 'view'}}" class="view-mode-actions">
        <button class="action-button cancel-button" bindtap="cancelApplication">撤销申请</button>
        <button class="action-button edit-button" bindtap="enterEditMode">编辑</button>
      </view>
    </view>
  </view>
</view>
</custom-nav-bar>
