<!--pages/shop/shop-detail/shop-detail.wxml-->
<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<custom-nav-bar title="é—¨åº—è¯¦æƒ…" showBack="{{true}}"></custom-nav-bar>

<view class="shop-detail-page">
  <view wx:if="{{loading}}" class="loading-wrap">
    <view class="loading">åŠ è½½ä¸­...</view>
  </view>

  <view wx:elif="{{shopInfo}}">
    <!-- å¤šå›¾è½®æ’­ -->
    <swiper class="shop-swiper" indicator-dots="{{true}}" autoplay="{{true}}" interval="{{3000}}" duration="{{500}}" circular="{{true}}">
      <swiper-item wx:for="{{gallery}}" wx:key="*this">
        <image class="swiper-image" src="{{item}}" mode="aspectFill"></image>
      </swiper-item>
    </swiper>

    <!-- åŸºç¡€ä¿¡æ¯å¡ç‰‡ -->
    <view class="card basic-info-card">
      <view class="shop-header">
        <view class="shop-name-row">
          <text class="shop-name">{{shopInfo.shopName}}</text>
          <text class="shop-item-type">{{shopInfo.shopType === 1 ? 'æ€»åº—' : 'åˆ†åº—'}}</text>
        </view>
        <view class="shop-rating-row" wx:if="{{shopInfo.ratingScore}}">
          <text class="rating-text">â­ {{shopInfo.ratingScore}}</text>
          <text class="rating-count">({{shopInfo.ratingCount || 0}}è¯„ä»·)</text>
        </view>
      </view>

      <view class="info-section">
        <view class="info-item" bindtap="openLocation">
          <image class="info-icon" src="{{iconLocation}}" mode="aspectFit"></image>
          <view class="info-content">
            <text class="info-label">åœ°å€</text>
            <text class="info-value">{{location}}</text>
          </view>
          <text class="nav-text">å¯¼èˆª</text>
        </view>
        <view class="info-item" bindtap="makeCall">
          <image class="info-icon" src="{{iconPhone}}" mode="aspectFit"></image>
          <view class="info-content">
            <text class="info-label">ç”µè¯</text>
            <text class="info-value link-text">{{shopInfo.phone}}</text>
          </view>
        </view>
        <view class="info-item" wx:if="{{shopInfo.businessHours}}">
          <image class="info-icon" src="{{iconTime}}" mode="aspectFit"></image>
          <view class="info-content">
            <text class="info-label">è¥ä¸šæ—¶é—´</text>
            <text class="info-value">{{shopInfo.businessHours}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åº—é“ºè¯¦æƒ…ä¿¡æ¯ -->
    <view class="card merchant-info-card" wx:if="{{shopInfo.description}}">
      <view class="section-title">åº—é“ºç®€ä»‹</view>
      <view class="shop-description">{{shopInfo.description}}</view>
    </view>

    <!-- çŠ¶æ€ä¿¡æ¯ -->
    <view class="card status-info-card">
      <view class="section-title">åº—é“ºçŠ¶æ€</view>
      <view class="status-row">
        <view class="status-item">
          <view class="status-label">è¥ä¸šçŠ¶æ€</view>
          <view class="status-value">
            <view class="status-tag status-{{shopInfo.status}}">
              {{shopInfo.status === 0 ? 'åœä¸š' : shopInfo.status === 1 ? 'è¥ä¸šä¸­' : 'è£…ä¿®ä¸­'}}
            </view>
          </view>
        </view>
        <view class="status-item">
          <view class="status-label">å®¡æ ¸çŠ¶æ€</view>
          <view class="status-value">
            <view class="status-tag status-{{shopInfo.reviewStatus}}">
              {{shopInfo.reviewStatus === 0 ? 'å¾…å®¡æ ¸' : shopInfo.reviewStatus === 1 ? 'å®¡æ ¸é€šè¿‡' : 'å®¡æ ¸å¤±è´¥'}}
            </view>
          </view>
        </view>
      </view>
      <view class="status-row" wx:if="{{shopInfo.isRecommended}}">
        <view class="status-item">
          <view class="status-label">æ ¡å‹ä¼šæ¨è</view>
          <view class="status-value">
            <view class="status-tag recommended">
              {{shopInfo.isRecommended === 1 ? 'æ˜¯' : 'å¦'}}
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¼˜æƒ åˆ¸åˆ—è¡¨ -->
    <view class="card coupon-section" wx:if="{{shopInfo.coupons && shopInfo.coupons.length}}">
      <view class="section-title">ä¼˜æƒ åˆ¸</view>
      <view class="coupon-list">
        <view class="coupon-card" wx:for="{{shopInfo.coupons}}" wx:key="couponId">
          <view class="coupon-left">
            <view class="coupon-discount">
              <text wx:if="{{item.couponType === 1}}">æŠ˜</text>
              <text wx:elif="{{item.couponType === 2}}">æ»¡{{item.minSpend}}å‡{{item.discountValue}}</text>
              <text wx:else>{{item.couponName}}</text>
            </view>
            <view class="coupon-label">ä¼˜æƒ åˆ¸</view>
          </view>
          <view class="coupon-divider"></view>
          <view class="coupon-right">
            <view class="coupon-title">{{item.couponName}}</view>
            <view class="coupon-desc">{{item.couponDesc}}</view>
            <view class="coupon-expire">æœ‰æ•ˆæœŸè‡³ {{item.validEndTime}}</view>
          </view>
          <view class="coupon-action" catchtap="handleCoupon" data-id="{{item.couponId}}">
            <view 
              class="coupon-btn {{item.status === 1 ? '' : 'disabled'}}"
            >
              ç«‹å³é¢†å–
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ´»åŠ¨åˆ—è¡¨ -->
    <view class="card activity-section">
      <view class="section-title">åº—é“ºæ´»åŠ¨</view>
      <view class="activity-list">
        <view class="activity-card" wx:for="{{shopInfo.activities || []}}" wx:key="activityId" catchtap="handleActivityTap" data-id="{{item.activityId}}">
          <view class="activity-card-inner">
            <view class="activity-left">
              <image class="activity-image" src="{{item.coverImage || ''}}" mode="aspectFill"></image>
            </view>
            <view class="activity-right">
              <view class="activity-header">
                <view class="activity-title">{{item.activityTitle || 'æš‚æ— æ´»åŠ¨æ ‡é¢˜'}}</view>
                <view class="status-tag status-{{item.status || 0}}">
                  {{item.status === 0 ? 'è‰ç¨¿' : item.status === 1 ? 'æŠ¥åä¸­' : item.status === 2 ? 'æŠ¥åç»“æŸ' : item.status === 3 ? 'è¿›è¡Œä¸­' : item.status === 4 ? 'å·²ç»“æŸ' : 'å·²å–æ¶ˆ'}}
                </view>
              </view>
              <view class="activity-organizer-info">
                <image class="organizer-avatar" src="{{item.organizerAvatar || ''}}" mode="aspectFill"></image>
                <view class="organizer-name">{{item.organizerName || 'æš‚æ— ä¸»åŠæ–¹'}}</view>
              </view>
              <view class="activity-details">
                <view class="detail-item">
                  <image class="detail-icon" src="{{iconTime}}" mode="aspectFit"></image>
                  <view class="detail-text">{{item.startTime || ''}} - {{item.endTime || ''}}</view>
                </view>
                <view class="detail-item">
                  <image class="detail-icon" src="{{iconLocation}}" mode="aspectFit"></image>
                  <view class="detail-text">{{item.activityCategory || 'æš‚æ— åˆ†ç±»'}}</view>
                </view>
              </view>
              <view class="activity-stats">
                <view class="stat-item">
                  <text class="stat-label">æµè§ˆ</text>
                  <text class="stat-value">{{item.viewCount || 0}}</text>
                </view>
                <view class="stat-item">
                  <text class="stat-label">æŠ¥å</text>
                  <text class="stat-value">{{item.currentParticipants || 0}}/{{item.maxParticipants || 0}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
        <view wx:if="{{!shopInfo.activities || shopInfo.activities.length === 0}}" class="no-activities">
          <view class="no-activities-icon">ğŸ¯</view>
          <view class="no-activities-text">æš‚æ— æ´»åŠ¨</view>
          <view class="no-activities-subtext">æ•¬è¯·æœŸå¾…æ›´å¤šç²¾å½©æ´»åŠ¨</view>
        </view>
      </view>
    </view>

    <!-- åº—é“ºç»Ÿè®¡ä¿¡æ¯ -->
    <view class="card stats-info-card" wx:if="{{shopInfo.viewCount || shopInfo.clickCount}}">
      <view class="section-title">åº—é“ºæ•°æ®</view>
      <view class="stats-row">
        <view class="stat-item" wx:if="{{shopInfo.viewCount}}">
          <view class="stat-value">{{shopInfo.viewCount}}</view>
          <view class="stat-label">æµè§ˆæ¬¡æ•°</view>
        </view>
        <view class="stat-item" wx:if="{{shopInfo.clickCount}}">
          <view class="stat-value">{{shopInfo.clickCount}}</view>
          <view class="stat-label">ç‚¹å‡»æ¬¡æ•°</view>
        </view>
        <view class="stat-item" wx:if="{{shopInfo.couponReceivedCount}}">
          <view class="stat-value">{{shopInfo.couponReceivedCount}}</view>
          <view class="stat-label">ä¼˜æƒ åˆ¸é¢†å–æ¬¡æ•°</view>
        </view>
        <view class="stat-item" wx:if="{{shopInfo.couponVerifiedCount}}">
          <view class="stat-value">{{shopInfo.couponVerifiedCount}}</view>
          <view class="stat-label">ä¼˜æƒ åˆ¸æ ¸é”€æ¬¡æ•°</view>
        </view>
      </view>
    </view>
  </view>
</view>