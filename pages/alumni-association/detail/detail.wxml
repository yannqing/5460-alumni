<!--pages/alumni-association/detail/detail.wxml-->
<custom-nav-bar showBack="{{true}}" useAuditStyle="{{true}}" auditTitle="æ ¡å‹ä¼šè¯¦æƒ…">
  <message-notification />
  
  <view class="association-detail-page">
    <view wx:if="{{associationInfo}}">
      <!-- è½®æ’­èƒŒæ™¯å›¾ -->
      <swiper class="cover-swiper" 
              indicator-dots="{{associationInfo.coverList.length > 1}}" 
              autoplay="{{associationInfo.coverList.length > 1}}" 
              circular="{{true}}"
              indicator-color="rgba(255, 255, 255, .3)"
              indicator-active-color="#ffffff">
        <swiper-item wx:for="{{associationInfo.coverList}}" wx:key="*this">
          <image class="cover-image" src="{{item}}" mode="aspectFill" />
        </swiper-item>
      </swiper>

      <!-- ç™½è‰²å†…å®¹åŒºåŸŸ -->
      <view class="white-background-content">
        <view class="card">
          <view class="flex">
            <image class="avatar avatar-large" src="{{associationInfo.icon}}" mode="aspectFill" />
            <view class="flex-1 ml-20">
              <view class="name-row">
                <text class="text-primary text-bold">{{associationInfo.name}}</text>
                <view wx:if="{{associationInfo.certifications && associationInfo.certifications.length}}" class="cert-tag-wrap">
                  <block wx:for="{{associationInfo.certifications}}" wx:key="id">
                    <view class="cert-tag" data-type="{{item.type}}" data-id="{{item.id}}" catchtap="handleCertificationTap">
                      {{item.label}}
                    </view>
                  </block>
                </view>
              </view>
              <view wx:if="{{associationInfo.schoolName}}" class="text-secondary mt-10 school-row" catchtap="viewSchoolDetail">
                <view class="school-tag">{{associationInfo.schoolName}}</view>
              </view>
              <view wx:if="{{associationInfo.location}}" class="text-placeholder mt-10 location-row">
                <image class="location-icon" src="{{iconLocation}}" mode="aspectFit" />
                <text>{{associationInfo.location}}</text>
              </view>
            </view>
          </view>
          <view class="mt-20">
            <view class="join-button {{associationInfo.applicationStatus === 0 ? 'pending' : ''}} {{associationInfo.applicationStatus === 1 ? 'joined' : ''}} {{associationInfo.applicationStatus === 2 ? 'rejected' : ''}}" bindtap="toggleJoin">
              <block wx:if="{{associationInfo.applicationStatus === 0}}">å®¡æ ¸ä¸­</block>
              <block wx:elif="{{associationInfo.applicationStatus === 1}}">å·²åŠ å…¥æ ¡å‹ä¼š</block>
              <block wx:elif="{{associationInfo.applicationStatus === 2}}">ç”³è¯·è¢«æ‹’ç»</block>
              <block wx:else>åŠ å…¥æ ¡å‹ä¼š</block>
            </view>
          </view>
        </view>

        <view class="tabs">
          <view class="tab-item {{activeTab === index ? 'active' : ''}}" wx:for="{{tabs}}" wx:key="*this" bindtap="switchTab" data-index="{{index}}">
            {{item}}
          </view>
        </view>

        <view wx:if="{{activeTab === 0}}" class="tab-content">
          <view class="card">
            <view class="text-bold mb-20">åŸºæœ¬ä¿¡æ¯</view>
            <view wx:if="{{associationInfo.description}}" class="text-secondary">{{associationInfo.description}}</view>
            <view class="divider"></view>
            <view wx:if="{{associationInfo.president}}" class="text-secondary">ä¼šé•¿ï¼š{{associationInfo.president}}</view>
            <view class="text-secondary mt-10">æˆå‘˜ï¼š{{associationInfo.memberCount || 0}}äºº</view>
            <view wx:if="{{associationInfo.establishedYear}}" class="text-secondary mt-10">æˆç«‹äºï¼š{{associationInfo.establishedYear}}å¹´</view>
            <view wx:if="{{associationInfo.contactInfo}}" class="text-secondary mt-10">è”ç³»ä¿¡æ¯ï¼š{{associationInfo.contactInfo}}</view>
          </view>

          <!-- é€šçŸ¥åˆ—è¡¨ -->
          <view class="card mt-20 dashboard-card">
            <view class="section-header">
              <view class="section-title">
                <view class="text-bold">é€šçŸ¥</view>
                <view class="section-subtitle">æœ€æ–°æé†’ã€é‡è¦åŠ¨æ€</view>
              </view>
              <view class="text-placeholder" bindtap="handleDeveloping">æŸ¥çœ‹æ›´å¤š</view>
            </view>
            <view class="dashboard-list notification" wx:for="{{notifications}}" wx:key="id" bindtap="viewNotificationDetail" data-id="{{item.id}}">
              <view class="dashboard-item">
                <view class="item-leading">
                  <view class="item-icon notify-icon">é€š</view>
                </view>
                <view class="item-content">
                  <view class="item-title">{{item.title}}</view>
                  <view class="item-desc">{{item.content}}</view>
                  <view class="item-meta">
                    <text>{{item.time}}</text>
                    <view wx:if="{{!item.isRead}}" class="status-dot"></view>
                  </view>
                </view>
                <view class="item-extra">
                  <text class="chevron">â€º</text>
                </view>
              </view>
            </view>
          </view>

          <!-- æ´»åŠ¨åˆ—è¡¨ -->
          <view class="card mt-20 dashboard-card">
            <view class="section-header">
              <view class="section-title">
                <view class="text-bold">æ´»åŠ¨</view>
                <view class="section-subtitle">è¿‘æœŸçƒ­ç‚¹æ ¡å‹æ´»åŠ¨</view>
              </view>
            </view>
            <view class="dashboard-list activity" wx:for="{{activityList}}" wx:key="activityId">
              <view class="dashboard-item activity-item" bindtap="viewActivityDetail" data-id="{{item.activityId}}">
                <view class="item-leading">
                  <image class="item-cover" src="{{item.coverImage}}" mode="aspectFill" />
                </view>
                <view class="item-content">
                  <view class="activity-header">
                    <view class="item-title">{{item.activityTitle}}</view>
                    <view class="activity-time">{{item.startTime}}</view>
                  </view>
                  <view class="activity-footer">
                    <view class="item-desc location-row">
                      <image class="location-icon" src="{{iconLocation}}" mode="aspectFit" />
                      <text>{{item.province}}{{item.city}}{{item.district}}{{item.address}}</text>
                    </view>
                    <view class="activity-participants">
                      <image class="participants-icon" src="/assets/icons/people.png" mode="aspectFit" />
                      <text>{{item.currentParticipants}}/{{item.maxParticipants}}äºº</text>
                    </view>
                  </view>
                </view>
              </view>
            </view>
          </view>

          <!-- é™„è¿‘æƒç›Šåˆ—è¡¨ -->
          <view class="card mt-20 dashboard-card">
            <view class="section-header">
              <view class="section-title">
                <view class="text-bold">é™„è¿‘æƒç›Š</view>
                <view class="section-subtitle">ä¼˜é€‰å•†æˆ·æƒç›Šéšæ—¶ç”¨</view>
              </view>
              <view class="text-placeholder" bindtap="handleDeveloping">æŸ¥çœ‹æ›´å¤š</view>
            </view>
            <view class="dashboard-list benefit" wx:for="{{nearbyBenefits}}" wx:key="id" bindtap="viewBenefitDetail" data-id="{{item.id}}">
              <view class="dashboard-item">
                <view class="item-leading benefit-leading">
                  <view class="benefit-tag">{{item.discount}}</view>
                </view>
                <view class="item-content">
                  <view class="item-title">
                    {{item.title}}
                    <view wx:if="{{item.isNew}}" class="new-badge-inline">ä¸Šæ–°</view>
                  </view>
                  <view class="item-desc">{{item.merchant}}</view>
                  <view class="item-meta">
                    <text>è·ç¦»{{item.distance}}</text>
                  </view>
                </view>
                <view class="item-extra">
                  <view class="item-chip ghost">æŸ¥çœ‹</view>
                  <text class="chevron">â€º</text>
                </view>
              </view>
            </view>
          </view>

          <!-- æ ¡å‹ä¼ä¸šåˆ—è¡¨ -->
          <view class="card mt-20 dashboard-card">
            <view class="section-header">
              <view class="section-title">
                <view class="text-bold">æ ¡å‹ä¼ä¸š</view>
                <view class="section-subtitle">ä¼˜ç§€æ ¡å‹åˆ›åŠçš„ä¼ä¸š</view>
              </view>
            </view>
            <view class="dashboard-list enterprise" wx:for="{{enterpriseList}}" wx:key="placeId">
              <view class="dashboard-item" bindtap="viewEnterpriseDetail" data-id="{{item.placeId}}">
                <view class="item-leading">
                  <block wx:if="{{item.logo}}">
                    <image class="item-logo" src="{{item.logo}}" mode="aspectFill" />
                  </block>
                  <block wx:else>
                    <view class="item-icon enterprise-icon">ä¼</view>
                  </block>
                </view>
                <view class="item-content">
                  <view class="item-title">{{item.placeName}}</view>
                  <view class="item-meta location-row">
                    <image class="location-icon" src="{{iconLocation}}" mode="aspectFit" />
                    <text>{{item.province}}{{item.city}}{{item.district}}</text>
                  </view>
                </view>
              </view>
            </view>
          </view>

          <!-- æ ¡å‹å•†é“ºåˆ—è¡¨ -->
          <view class="card mt-20 dashboard-card">
            <view class="section-header">
              <view class="section-title">
                <view class="text-bold">æ ¡å‹å•†é“º</view>
                <view class="section-subtitle">æ ¡å‹ç»è¥çš„ä¼˜è´¨å•†é“º</view>
              </view>
              <view class="text-placeholder" bindtap="handleDeveloping">æŸ¥çœ‹æ›´å¤š</view>
            </view>
            <view class="dashboard-list shop" wx:for="{{alumniShops}}" wx:key="id" bindtap="viewShopDetail" data-id="{{item.id}}">
              <view class="dashboard-item">
                <view class="item-leading">
                  <view class="item-icon shop-icon">å•†</view>
                </view>
                <view class="item-content">
                  <view class="item-title">{{item.name}}</view>
                  <view class="item-desc">{{item.description}}</view>
                  <view class="item-meta">
                    <text class="rating-text">â­ {{item.rating}}</text>
                    <text class="meta-divider">Â·</text>
                    <text>{{item.category}}</text>
                    <text class="meta-divider">Â·</text>
                    <text>è·ç¦»{{item.distance}}</text>
                  </view>
                </view>
                <view class="item-extra">
                  <text class="chevron">â€º</text>
                </view>
              </view>
            </view>
          </view>
        </view>

        <view wx:if="{{activeTab === 1}}">
          <view class="member-list">
            <!-- éª¨æ¶å± -->
            <view wx:if="{{loading && members.length === 0}}" class="skeleton-list">
              <view class="member-item skeleton-item" wx:for="[1,2,3,4,5]" wx:key="*this">
                <view class="member-avatar skeleton-avatar"></view>
                <view class="member-info">
                  <view class="member-name-row">
                    <view class="skeleton-name"></view>
                    <view class="skeleton-tag"></view>
                  </view>
                  <view class="skeleton-text"></view>
                </view>
              </view>
            </view>
            
            <!-- æˆå‘˜åˆ—è¡¨ -->
            <view wx:elif="{{members.length > 0}}">
              <view class="member-item" wx:for="{{members}}" wx:key="id" bindtap="viewMemberDetail" data-id="{{item.id}}">
                <image class="member-avatar" src="{{item.avatar}}" mode="aspectFill" />
                <view class="member-info">
                  <view class="member-name-row">
                    <text class="member-name">{{item.name}}</text>
                    <view class="member-tag">{{item.role}}</view>
                  </view>
                  <view class="member-company">{{item.company}}</view>
                </view>
              </view>
            </view>
            
            <!-- ç©ºçŠ¶æ€ -->
            <view wx:else class="empty-container">
              <view class="empty-icon">ğŸ‘¥</view>
              <view class="empty-text">æš‚æ— æˆå‘˜æ•°æ®</view>
              <view class="empty-desc">è¯¥æ ¡å‹ä¼šè¿˜æ²¡æœ‰æˆå‘˜ï¼Œå¿«æ¥åŠ å…¥å§</view>
            </view>
          </view>
        </view>

        <!-- ç»„ç»‡ç»“æ„æ ‡ç­¾é¡µ -->
        <view wx:if="{{activeTab === 2}}" class="tab-content">
          <view class="card dashboard-card">
            <view class="section-header">
              <view class="section-title">
                <view class="text-bold">ç»„ç»‡ç»“æ„</view>
                <view class="section-subtitle">ç»„ç»‡æ¶æ„å±•ç¤º</view>
              </view>
            </view>
            
            <view class="role-list-section">
              <!-- éª¨æ¶å± -->
              <view wx:if="{{organizationLoading}}" class="skeleton-role-list">
                <view class="role-item skeleton-item" wx:for="[1,2,3]" wx:key="*this">
                  <view class="role-header">
                    <view class="role-name-container">
                      <text class="expand-icon">â–¶</text>
                      <view class="skeleton-role-name"></view>
                    </view>
                    <view class="skeleton-role-count"></view>
                  </view>
                </view>
              </view>
              
              <!-- ç©ºçŠ¶æ€ -->
              <view wx:elif="{{roleList.length === 0}}" class="empty-container">
                <text class="empty-text">æš‚æ— è§’è‰²æ•°æ®</text>
              </view>
              
              <org-structure list="{{roleList}}" loading="{{organizationLoading}}" empty-text="æš‚æ— è§’è‰²æ•°æ®" />
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</custom-nav-bar>
