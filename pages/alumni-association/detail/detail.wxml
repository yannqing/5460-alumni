<!--pages/alumni-association/detail/detail.wxml-->
<view class="container">
  <view wx:if="{{associationInfo}}">
    <image class="cover-image" src="{{associationInfo.cover}}" mode="aspectFill" />

    <view class="card">
      <view class="flex">
        <image class="avatar avatar-large" src="{{associationInfo.icon}}" mode="aspectFill" />
        <view class="flex-1 ml-20">
          <view class="name-row">
            <text class="text-primary text-bold">{{associationInfo.name}}</text>
            <view class="cert-tag-wrap">
              <block wx:if="{{associationInfo.certifications && associationInfo.certifications.length}}" wx:for="{{associationInfo.certifications}}" wx:key="id">
                <view class="cert-tag" data-type="{{item.type}}" data-id="{{item.id}}" catchtap="handleCertificationTap">
                  {{item.label}}
                </view>
              </block>
              <!-- æµ‹è¯•ï¼šæ ¡å‹æ€»ä¼š / æ ¡å¤„ä¼šä¸¤ä¸ªæµ‹è¯•æ ‡ç­¾ -->
              <view wx:if="{{testUnionId}}" 
                    class="cert-tag" 
                    data-type="union" 
                    data-id="{{testUnionId}}" 
                    catchtap="handleCertificationTap">
                æ€»ä¼šæµ‹è¯•
              </view>
              <view wx:if="{{associationInfo.platformId}}" 
                    class="cert-tag" 
                    data-type="platform" 
                    data-id="{{associationInfo.platformId}}" 
                    catchtap="handleCertificationTap">
                æ ¡å¤„ä¼šæµ‹è¯•
              </view>
            </view>
          </view>
          <view wx:if="{{associationInfo.schoolName}}" class="text-secondary mt-10 school-row" catchtap="viewSchoolDetail">
            <image class="school-icon" src="{{iconSchool}}" mode="aspectFit" />
            <view class="school-tag">{{associationInfo.schoolName}}</view>
          </view>
          <view wx:if="{{associationInfo.location}}" class="text-placeholder mt-10 location-row">
            <image class="location-icon" src="{{iconLocation}}" mode="aspectFit" />
            <text>{{associationInfo.location}}</text>
          </view>
        </view>
      </view>
      <view class="mt-20">
        <view class="join-button {{associationInfo.isJoined ? 'joined' : ''}}" bindtap="toggleJoin">
          {{associationInfo.isJoined ? 'å·²åŠ å…¥æ ¡å‹ä¼š' : 'åŠ å…¥æ ¡å‹ä¼š'}}
        </view>
      </view>
    </view>

    <view class="tabs">
      <view class="tab-item {{activeTab === index ? 'active' : ''}}" wx:for="{{tabs}}" wx:key="*this" bindtap="switchTab" data-index="{{index}}">
        {{item}}
      </view>
    </view>

    <view wx:if="{{activeTab === 0}}" class="tab-content">
      <view class="card">
        <view class="text-bold mb-20">åŸºæœ¬ä¿¡æ¯</view>
        <view wx:if="{{associationInfo.description}}" class="text-secondary">{{associationInfo.description}}</view>
        <view class="divider"></view>
        <view wx:if="{{associationInfo.president}}" class="text-secondary">ä¼šé•¿ï¼š{{associationInfo.president}}</view>
        <view class="text-secondary mt-10">æˆå‘˜ï¼š{{associationInfo.memberCount || 0}}äºº</view>
        <view wx:if="{{associationInfo.establishedYear}}" class="text-secondary mt-10">æˆç«‹äºï¼š{{associationInfo.establishedYear}}å¹´</view>
        <view wx:if="{{associationInfo.contactInfo}}" class="text-secondary mt-10">è”ç³»ä¿¡æ¯ï¼š{{associationInfo.contactInfo}}</view>
      </view>

      <!-- é€šçŸ¥åˆ—è¡¨ -->
      <view class="card mt-20 dashboard-card">
        <view class="section-header">
          <view class="section-title">
            <view class="text-bold">é€šçŸ¥</view>
            <view class="section-subtitle">æœ€æ–°æé†’ã€é‡è¦åŠ¨æ€</view>
          </view>
          <view class="text-placeholder" bindtap="viewNotificationDetail" data-id="all">æŸ¥çœ‹æ›´å¤š</view>
        </view>
        <view class="dashboard-list notification" wx:for="{{notifications}}" wx:key="id" bindtap="viewNotificationDetail" data-id="{{item.id}}">
          <view class="dashboard-item">
            <view class="item-leading">
              <view class="item-icon notify-icon">é€š</view>
            </view>
            <view class="item-content">
              <view class="item-title">{{item.title}}</view>
              <view class="item-desc">{{item.content}}</view>
              <view class="item-meta">
                <text>{{item.time}}</text>
                <view wx:if="{{!item.isRead}}" class="status-dot"></view>
              </view>
            </view>
            <view class="item-extra">
              <text class="chevron">â€º</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æ´»åŠ¨åˆ—è¡¨ -->
      <view class="card mt-20 dashboard-card">
        <view class="section-header">
          <view class="section-title">
            <view class="text-bold">æ´»åŠ¨</view>
            <view class="section-subtitle">è¿‘æœŸçƒ­ç‚¹æ ¡å‹æ´»åŠ¨</view>
          </view>
          <view class="text-placeholder" bindtap="viewActivityDetail" data-id="all">æŸ¥çœ‹æ›´å¤š</view>
        </view>
        <view class="dashboard-list activity" wx:for="{{benefitActivities}}" wx:key="id" bindtap="viewActivityDetail" data-id="{{item.id}}">
          <view class="dashboard-item">
            <view class="item-leading">
              <view class="item-icon activity-icon">æ´»</view>
            </view>
            <view class="item-content">
              <view class="item-title">{{item.title}}</view>
              <view class="item-desc location-row">
                <image class="location-icon" src="{{iconLocation}}" mode="aspectFit" />
                <text>{{item.location}}</text>
              </view>
              <view class="item-meta">
                <text>ğŸ• {{item.time}}</text>
                <text class="meta-divider">Â·</text>
                <text>{{item.participantCount}}äººæŠ¥å</text>
              </view>
            </view>
            <view class="item-extra">
              <view class="item-chip">æŠ¥åä¸­</view>
              <text class="chevron">â€º</text>
            </view>
          </view>
        </view>
      </view>

      <!-- é™„è¿‘æƒç›Šåˆ—è¡¨ -->
      <view class="card mt-20 dashboard-card">
        <view class="section-header">
          <view class="section-title">
            <view class="text-bold">é™„è¿‘æƒç›Š</view>
            <view class="section-subtitle">ä¼˜é€‰å•†æˆ·æƒç›Šéšæ—¶ç”¨</view>
          </view>
          <view class="text-placeholder" bindtap="viewBenefitDetail" data-id="all">æŸ¥çœ‹æ›´å¤š</view>
        </view>
        <view class="dashboard-list benefit" wx:for="{{nearbyBenefits}}" wx:key="id" bindtap="viewBenefitDetail" data-id="{{item.id}}">
          <view class="dashboard-item">
            <view class="item-leading benefit-leading">
              <view class="benefit-tag">{{item.discount}}</view>
            </view>
            <view class="item-content">
              <view class="item-title">
                {{item.title}}
                <view wx:if="{{item.isNew}}" class="new-badge-inline">ä¸Šæ–°</view>
              </view>
              <view class="item-desc">{{item.merchant}}</view>
              <view class="item-meta">
                <text>è·ç¦»{{item.distance}}</text>
              </view>
            </view>
            <view class="item-extra">
              <view class="item-chip ghost">æŸ¥çœ‹</view>
              <text class="chevron">â€º</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æ ¡å‹ä¼ä¸šåˆ—è¡¨ -->
      <view class="card mt-20 dashboard-card">
        <view class="section-header">
          <view class="section-title">
            <view class="text-bold">æ ¡å‹ä¼ä¸š</view>
            <view class="section-subtitle">ä¼˜ç§€æ ¡å‹åˆ›åŠçš„ä¼ä¸š</view>
          </view>
          <view class="text-placeholder" bindtap="viewEnterpriseDetail" data-id="all">æŸ¥çœ‹æ›´å¤š</view>
        </view>
        <view class="dashboard-list enterprise" wx:for="{{alumniEnterprises}}" wx:key="id" bindtap="viewEnterpriseDetail" data-id="{{item.id}}">
          <view class="dashboard-item">
            <view class="item-leading">
              <view class="item-icon enterprise-icon">ä¼</view>
            </view>
            <view class="item-content">
              <view class="item-title">{{item.name}}</view>
              <view class="item-desc">{{item.description}}</view>
              <view class="item-meta">
                <text>{{item.industry}}</text>
                <text class="meta-divider">Â·</text>
                <text>{{item.location}}</text>
              </view>
            </view>
            <view class="item-extra">
              <text class="chevron">â€º</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æ ¡å‹å•†é“ºåˆ—è¡¨ -->
      <view class="card mt-20 dashboard-card">
        <view class="section-header">
          <view class="section-title">
            <view class="text-bold">æ ¡å‹å•†é“º</view>
            <view class="section-subtitle">æ ¡å‹ç»è¥çš„ä¼˜è´¨å•†é“º</view>
          </view>
          <view class="text-placeholder" bindtap="viewShopDetail" data-id="all">æŸ¥çœ‹æ›´å¤š</view>
        </view>
        <view class="dashboard-list shop" wx:for="{{alumniShops}}" wx:key="id" bindtap="viewShopDetail" data-id="{{item.id}}">
          <view class="dashboard-item">
            <view class="item-leading">
              <view class="item-icon shop-icon">å•†</view>
            </view>
            <view class="item-content">
              <view class="item-title">{{item.name}}</view>
              <view class="item-desc">{{item.description}}</view>
              <view class="item-meta">
                <text class="rating-text">â­ {{item.rating}}</text>
                <text class="meta-divider">Â·</text>
                <text>{{item.category}}</text>
                <text class="meta-divider">Â·</text>
                <text>è·ç¦»{{item.distance}}</text>
              </view>
            </view>
            <view class="item-extra">
              <text class="chevron">â€º</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <view wx:if="{{activeTab === 1}}">
      <view class="member-list">
        <view class="member-item" wx:for="{{members}}" wx:key="id">
          <image class="member-avatar" src="{{item.avatar}}" mode="aspectFill" />
          <view class="member-info">
            <view class="member-name-row">
              <text class="member-name">{{item.name}}</text>
              <view class="member-tag">{{item.role}}</view>
            </view>
            <view class="member-company">{{item.company}}</view>
          </view>
        </view>
      </view>
    </view>

  </view>

  <!-- åŠ å…¥æ ¡å‹ä¼šç”³è¯·è¡¨å•å¼¹çª— -->
  <view wx:if="{{showJoinModal}}" class="join-modal-mask" catchtouchmove="true">
    <view class="join-modal">
      <view class="join-modal-title">åŠ å…¥æ ¡å‹ä¼šç”³è¯·</view>
      <view class="join-modal-subtitle">è¯·å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼Œæäº¤åå°†ç”±ç®¡ç†å‘˜å®¡æ ¸</view>

      <view class="join-form-item">
        <view class="join-form-label">çœŸå®å§“å</view>
        <input
          class="join-form-input"
          placeholder="è¯·è¾“å…¥çœŸå®å§“å"
          value="{{joinForm.realName}}"
          data-field="realName"
          bindinput="handleJoinInput"
        />
      </view>

      <view class="join-form-item">
        <view class="join-form-label">æ¯•ä¸šå¹´ä»½</view>
        <input
          class="join-form-input"
          placeholder="ä¾‹å¦‚ï¼š2018"
          value="{{joinForm.graduationYear}}"
          data-field="graduationYear"
          bindinput="handleJoinInput"
        />
      </view>

      <view class="join-form-item">
        <view class="join-form-label">ä¸“ä¸š / é™¢ç³»</view>
        <input
          class="join-form-input"
          placeholder="è¯·è¾“å…¥æ¯•ä¸šä¸“ä¸šæˆ–æ‰€åœ¨é™¢ç³»"
          value="{{joinForm.major}}"
          data-field="major"
          bindinput="handleJoinInput"
        />
      </view>

      <view class="join-form-item">
        <view class="join-form-label">ç”³è¯·è¯´æ˜</view>
        <textarea
          class="join-form-textarea"
          placeholder="å¯ä»¥ç®€å•ä»‹ç»ä¸€ä¸‹è‡ªå·±ï¼Œæˆ–è¡¥å……è¯´æ˜ç”³è¯·ç†ç”±ï¼ˆé€‰å¡«ï¼‰"
          value="{{joinForm.remark}}"
          data-field="remark"
          bindinput="handleJoinInput"
        />
      </view>

      <view class="join-modal-actions">
        <view class="join-modal-btn cancel" bindtap="closeJoinModal">å–æ¶ˆ</view>
        <view class="join-modal-btn submit" bindtap="submitJoinApplication">
          {{joinSubmitting ? 'æäº¤ä¸­...' : 'æäº¤ç”³è¯·'}}
        </view>
      </view>
    </view>
  </view>
</view>
