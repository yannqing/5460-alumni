<!--pages/activity/list/list.wxml-->
<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<custom-nav-bar title="æ´»åŠ¨" showBack="{{true}}"></custom-nav-bar>

<!-- æ¶ˆæ¯é€šçŸ¥ç»„ä»¶ -->
<message-notification />

<view class="container activity-page">
  <view class="form-card" wx:if="{{!hasSingleAlumniAssociation && hasAlumniAdminPermission}}">
    <view class="form-title">æ ¡å‹æ´»åŠ¨</view>

    <!-- é€‰æ‹©æ ¡å‹ä¼š -->
    <view class="form-item">
      <text class="label">é€‰æ‹©æ ¡å‹ä¼š</text>
      <view class="alumni-association-selector" bindtap="showAlumniAssociationSelector">
        <text class="selector-label">{{selectedAlumniAssociationName || 'è¯·é€‰æ‹©æ ¡å‹ä¼š'}}</text>
        <text class="selector-arrow">â–¼</text>
      </view>
    </view>
  </view>

  <view class="activity-hero card">
    <view class="hero-header">
      <view>
        <view class="hero-title">æ ¡å‹æ´»åŠ¨</view>
        <view class="hero-subtitle">ä¸€èµ·é“¾æ¥æ›´æœ‰èƒ½é‡çš„åŒä¼´</view>
      </view>
      <button class="hero-btn" size="mini" plain bindtap="goToPublish">å‘å¸ƒæ´»åŠ¨</button>
    </view>
  </view>

  <scroll-view class="filter-tabs" scroll-x>
    <view
      class="tab {{filterStatus === option.id ? 'active' : ''}}"
      wx:for="{{filterOptions}}"
      wx:key="id"
      data-id="{{option.id}}"
      bindtap="handleFilterChange"
    >
      {{option.label}}
    </view>
  </scroll-view>

  <view wx:if="{{!displayList.length}}" class="empty-block card">
    <image src="https://cdn.example.com/empty-activity.png" mode="widthFix"></image>
    <text>{{selectedAlumniAssociationId ? 'æš‚æ— åŒ¹é…çš„æ´»åŠ¨ï¼Œæ¢ä¸ªæ¡ä»¶è¯•è¯•' : 'è¯·å…ˆé€‰æ‹©æ ¡å‹ä¼š'}}</text>
  </view>

  <view class="activity-list">
    <view
      class="card activity-card"
      wx:for="{{displayList}}"
      wx:key="id"
      bindtap="viewDetail"
      data-id="{{item.id}}"
    >
      <view class="activity-header">
        <view class="activity-title">{{item.title}}</view>
        <view class="status-badge {{item.status}}">
          {{item.originalStatus === 0 ? 'è‰ç¨¿' : item.originalStatus === 1 ? 'æŠ¥åä¸­' : item.originalStatus === 2 ? 'æŠ¥åç»“æŸ' : item.originalStatus === 3 ? 'è¿›è¡Œä¸­' : item.originalStatus === 4 ? 'å·²ç»“æŸ' : item.originalStatus === 5 ? 'å·²å–æ¶ˆ' : 'å³å°†å¼€å§‹'}}
        </view>
      </view>
      <view class="activity-meta">
        <text>{{item.organizer}}</text>
        <text class="dot">Â·</text>
        <text>{{item.participantCount}}äººå·²æŠ¥</text>
      </view>
      <view class="activity-tags" wx:if="{{item.tags.length > 0}}">
        <view class="tag" wx:for="{{item.tags}}" wx:key="*this">{{item}}</view>
      </view>
      <view class="activity-footer">
        <text wx:if="{{item.location}}">ğŸ“ {{item.location}}</text>
        <text class="time">ğŸ• {{item.startTime}}</text>
      </view>
      <view class="activity-actions">
        <button class="edit-btn" catchtap="editActivity" data-id="{{item.id}}">ç¼–è¾‘</button>
        <button class="delete-btn" catchtap="deleteActivity" data-id="{{item.id}}">åˆ é™¤</button>
      </view>
    </view>
  </view>

  <!-- æ ¡å‹ä¼šé€‰æ‹©å™¨å¼¹çª— -->
  <view class="alumni-association-picker" wx:if="{{showAlumniAssociationPicker}}">
    <view class="picker-overlay" bindtap="cancelAlumniAssociationSelect"></view>
    <view class="picker-content">
      <view class="picker-header">
        <text class="picker-title">é€‰æ‹©æ ¡å‹ä¼š</text>
        <text class="picker-cancel" bindtap="cancelAlumniAssociationSelect">å–æ¶ˆ</text>
      </view>
      <view class="picker-list">
        <view 
          class="picker-item"
          wx:for="{{alumniAssociationList}}"
          wx:key="alumniAssociationId"
          data-alumni-association-id="{{item.alumniAssociationId}}"
          data-alumni-association-name="{{item.alumniAssociationName}}"
          bindtap="selectAlumniAssociation"
        >
          <text class="item-name">{{item.alumniAssociationName}}</text>
          <text class="item-check" wx:if="{{selectedAlumniAssociationId == item.alumniAssociationId}}">âœ“</text>
        </view>
        <view class="picker-empty" wx:if="{{alumniAssociationList.length === 0}}">
          <text>æš‚æ— æ ¡å‹ä¼šæ•°æ®</text>
        </view>
      </view>
    </view>
  </view>
</view>
