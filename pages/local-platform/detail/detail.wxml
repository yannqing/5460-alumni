<custom-nav-bar showBack="{{true}}" useAuditStyle="{{true}}" auditTitle="Ê†°‰øÉ‰ºöËØ¶ÊÉÖ">
<message-notification />
<view class="platform-detail-page">
    <view wx:if="{{loading}}" class="loading-wrap">
        <view class="loading">Âä†ËΩΩ‰∏≠...</view>
    </view>
    <view wx:elif="{{platformInfo}}">
        <view class="top-background-container">
            <image class="cover-image" src="{{platformInfo.cover}}" mode="aspectFill" />
            <view class="bg-gradient-overlay"></view>
        </view>
            <!-- ÁôΩËâ≤ËÉåÊôØÂÜÖÂÆπÂå∫Âüü -->
            <view class="white-background">
                <view class="card">
                    <view class="flex">
                        <image class="avatar avatar-large" src="{{platformInfo.icon}}" mode="aspectFill" />
                        <view class="flex-1 ml-20">
                            <view class="name-row">
                                <text class="text-primary text-bold">{{platformInfo.platformName}}</text>
                            </view>
                            <view wx:if="{{platformInfo.city}}" class="text-secondary mt-10 location-row">
                                <image class="location-icon" src="{{iconLocation}}" mode="aspectFit" />
                                <text>{{platformInfo.city}}</text>
                            </view>
                        </view>
                    </view>
                </view>
                <!-- È°∂ÈÉ® TabÔºå‰∏éÊ†°Âèã‰ºö‰∏ªÈ°µ‰∏ÄËá¥ÔºöÂü∫Êú¨‰ø°ÊÅØ / ÊàêÂëòÂàóË°® -->
                <view class="tabs">
                    <view 
                        class="tab-item {{activeTab === index ? 'active' : ''}}" 
                        wx:for="{{tabs}}" 
                        wx:key="*this" 
                        bindtap="switchTab" 
                        data-index="{{index}}"
                    >
                        {{item}}
                    </view>
                </view>
                <!-- Tab ÂÜÖÂÆπÔºöÂü∫Êú¨‰ø°ÊÅØ -->
                <view wx:if="{{activeTab === 0}}" class="tab-content">
                    <view class="card">
                        <view class="text-bold mb-20">Âü∫Êú¨‰ø°ÊÅØ</view>
                        <view class="basic-info-item">ËÅîÁ≥ª‰ø°ÊÅØÔºö{{platformInfo.contactInfo || 'ÊöÇÊó†'}}</view>
                        <view class="basic-info-item" wx:if="{{platformInfo.city}}">ÊâÄÂú®ÂüéÂ∏ÇÔºö{{platformInfo.city}}</view>
                        <view class="basic-info-item" wx:if="{{platformInfo.associationCount}}">ÂÖ≥ËÅîÊ†°Âèã‰ºöÊï∞ÈáèÔºö{{platformInfo.associationCount}}‰∏™</view>
                        <view class="basic-info-item" wx:if="{{platformInfo.memberCount}}">‰ºöÂëòÔºö{{platformInfo.memberCount}}‰∫∫</view>
                        <view class="basic-info-item" wx:if="{{platformInfo.description}}">ÁÆÄ‰ªã: {{platformInfo.description}}</view>
                    </view>
                </view>
                <!-- Tab ÂÜÖÂÆπÔºöÁªÑÁªáÁªìÊûÑ -->
                <view wx:if="{{activeTab === 1}}" class="tab-content">
                    <view class="card dashboard-card">
                        <view class="section-header">
                            <view class="section-title">
                                <view class="text-bold">ÁªÑÁªáÁªìÊûÑ</view>
                                <view class="section-subtitle">ÁªÑÁªáÊû∂ÊûÑÂ±ïÁ§∫</view>
                            </view>
                            <view wx:if="{{canEditOrg}}" class="section-edit-btn">
                                <view wx:if="{{!isEditOrgMode}}" class="edit-btn" bindtap="onEditOrgClick">
                                    <text class="edit-text">ÁºñËæë</text>
                                </view>
                                <view wx:else class="edit-btn cancel-btn" bindtap="onCancelOrgEdit">
                                    <text class="edit-text">ÂèñÊ∂à</text>
                                </view>
                            </view>
                        </view>
                        <org-structure 
                            id="org-structure" 
                            list="{{roleList}}" 
                            loading="{{organizationLoading}}" 
                            empty-text="ÊöÇÊó†ËßíËâ≤Êï∞ÊçÆ" 
                            isLocalPlatform="{{true}}" 
                            localPlatformId="{{platformId}}" 
                            bind:refresh="onOrgStructureRefresh"
                        />
                    </view>
                </view>
                <!-- Tab ÂÜÖÂÆπÔºö‰ºöÂëòÂàóË°® -->
                <view wx:if="{{activeTab === 2}}">
                    <view class="member-list">
                        <!-- È™®Êû∂Â±è -->
                        <view wx:if="{{associationLoading && associations.length === 0}}" class="skeleton-list">
                            <view class="member-item skeleton-item" wx:for="[1,2,3,4,5]" wx:key="*this">
                                <view class="member-avatar skeleton-avatar"></view>
                                <view class="member-info">
                                    <view class="member-name-row">
                                        <view class="skeleton-name"></view>
                                    </view>
                                    <view class="skeleton-text"></view>
                                    <view class="skeleton-text"></view>
                                </view>
                            </view>
                        </view>
                        <!-- Á©∫Áä∂ÊÄÅ -->
                        <view wx:elif="{{!associations.length}}" class="empty-container">
                            <view class="empty-icon">üë•</view>
                            <view class="empty-text">ÊöÇÊó†Ê†°Âèã‰ºö</view>
                            <view class="empty-desc">ËØ•Âπ≥Âè∞ËøòÊ≤°ÊúâÂÖ≥ËÅîÁöÑÊ†°Âèã‰ºö</view>
                        </view>
                        <!-- ÂÆûÈôÖÊï∞ÊçÆ -->
                        <view wx:else>
                            <view class="member-item" wx:for="{{associations}}" wx:key="alumniAssociationId" bindtap="viewAssociationDetail" data-id="{{item.alumniAssociationId}}">
                                <image class="member-avatar" src="{{item.avatar}}" mode="aspectFill" />
                                <view class="member-info">
                                    <view class="member-name-row">
                                        <text class="member-name">{{item.associationName}}</text>
                                    </view>
                                    <view class="member-meta">
                                        <view class="meta-item" wx:if="{{item.location}}">
                                            <image class="meta-icon" src="{{iconLocation}}" mode="aspectFit" />
                                            <text>{{item.location}}</text>
                                        </view>
                                        <view class="meta-item" wx:else>
                                            <text>ÊöÇÊó†Âú∞ÁÇπ</text>
                                        </view>
                                        <view class="meta-item">
                                            <image class="meta-icon" src="{{iconPeople}}" mode="aspectFit" />
                                            <text>{{item.memberCount}}‰∫∫</text>
                                        </view>
                                    </view>
                                </view>
                                <view wx:if="{{item.role === 0}}" class="role-tag member-tag">‰ºöÂëòÂçï‰Ωç</view>
                                <view wx:elif="{{item.role === 1}}" class="role-tag director-tag">ÁêÜ‰∫ãÂçï‰Ωç</view>
                            </view>
                        </view>
                        <!-- Âä†ËΩΩÊõ¥Â§ö -->
                        <view wx:if="{{associationLoading && associations.length > 0}}" class="loading-more">Âä†ËΩΩ‰∏≠...</view>
                        <view wx:elif="{{!hasMore && associations.length}}" class="no-more">Ê≤°ÊúâÊõ¥Â§ö‰∫Ü</view>
                    </view>
                </view>
            </view>
        </view>
        <!-- Êñ∞Â¢ûÔºöplatformInfo ‰∏∫Á©∫Êó∂ÁöÑÁ©∫Áä∂ÊÄÅÂ±ïÁ§∫ -->
        <view wx:else class="empty-state">
            <view class="empty-placeholder">ÊöÇÊó†Êï∞ÊçÆ</view>
            <text>ÊöÇÊó†Ê†°‰øÉ‰ºö‰ø°ÊÅØ</text>
    </view>
</view>
</custom-nav-bar>
