<!--pages/school/list/list.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrap">
      <input class="search-input" type="text" placeholder="æœç´¢æ¯æ ¡åç§°ã€æ›¾ç”¨å" value="{{keyword}}" bindinput="onSearchInput" bindconfirm="onSearch" />
      <view class="search-icon" bindtap="onSearch">ğŸ”</view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åºæ  -->
  <view class="filter-bar">
    <view class="filter-item" bindtap="toggleFollowFilter">
      <text class="{{filterType === 'followed' ? 'theme-color' : ''}}">{{filterType === 'followed' ? 'å·²å…³æ³¨' : 'å…¨éƒ¨'}}</text>
    </view>
    <view class="filter-item" bindtap="showFilterPanel">
      <text>{{selectedCity}}</text>
      <text class="arrow-down">â–¾</text>
    </view>
    <view class="filter-item" bindtap="showSortPanel">
      <text>{{selectedSort}}</text>
      <text class="arrow-down">â–¾</text>
    </view>
    <view class="filter-item" bindtap="goToMyFollow">
      <text>æˆ‘çš„å…³æ³¨</text>
    </view>
  </view>

  <!-- å­¦æ ¡åˆ—è¡¨ -->
  <view class="school-list">
    <view class="school-item" wx:for="{{schoolList}}" wx:key="id" bindtap="viewDetail" data-id="{{item.id}}">
      <view class="school-header">
        <image class="school-icon" src="{{item.icon}}" mode="aspectFill" />
        <view class="school-info">
          <view class="school-name-row">
            <text class="school-name">{{item.name}}</text>
            <view wx:if="{{item.isCertified}}" class="certified-badge">âœ“ è®¤è¯</view>
          </view>
          <view wx:if="{{item.oldNames && item.oldNames.length > 0}}" class="school-old-names">
            <text class="old-name-label">æ›¾ç”¨åï¼š</text>
            <text>{{item.oldNames.join('ã€')}}</text>
          </view>
          <view class="school-location">åœ°ç‚¹ï¼š{{item.location}}</view>
          <view class="school-tags">
            <text class="tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
          </view>
        </view>
      </view>
      <view class="school-footer">
        <view class="school-stats">
          <text class="stat-item">æ ¡å‹ {{item.alumniCount}}</text>
          <text class="stat-divider">|</text>
          <text class="stat-item">æ ¡å‹ä¼š {{item.associationCount}}</text>
        </view>
        <view class="school-action" catchtap="toggleFollow" data-id="{{item.id}}" data-followed="{{item.isFollowed}}">
          <view class="btn btn-small {{item.isFollowed ? 'btn-plain' : 'btn-primary'}}">
            {{item.isFollowed ? 'å·²å…³æ³¨' : '+ å…³æ³¨'}}
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>
    <view wx:elif="{{!hasMore}}" class="loading">æ²¡æœ‰æ›´å¤šäº†</view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{!loading && schoolList.length === 0}}" class="empty-state">
      <image src="https://via.placeholder.com/200/f0f0f0/999999?text=Empty" mode="aspectFill" />
      <text>æš‚æ— æ•°æ®</text>
    </view>
  </view>

  <!-- åŸå¸‚ç­›é€‰å¼¹çª— -->
  <view class="popup-mask" wx:if="{{showFilter}}" bindtap="hideFilterPanel" catchtouchmove="true">
    <view class="popup-content" catchtap="stopPropagation">
      <view class="popup-header">
        <text class="popup-title">é€‰æ‹©åŸå¸‚</text>
        <text class="popup-close" bindtap="hideFilterPanel">âœ•</text>
      </view>
      <view class="city-list">
        <view class="city-item {{selectedCity === item ? 'active' : ''}}" wx:for="{{cityList}}" wx:key="*this" bindtap="onCityChange" data-city="{{item}}">
          <text>{{item}}</text>
          <text wx:if="{{selectedCity === item}}" class="check-icon">âœ“</text>
        </view>
      </view>
      <view class="popup-footer">
        <view class="btn btn-primary full-width" bindtap="confirmFilter">ç¡®å®š</view>
      </view>
    </view>
  </view>

  <!-- æ’åºå¼¹çª— -->
  <view class="popup-mask" wx:if="{{showSort}}" bindtap="hideSortPanel" catchtouchmove="true">
    <view class="popup-content" catchtap="stopPropagation">
      <view class="popup-header">
        <text class="popup-title">é€‰æ‹©æ’åº</text>
        <text class="popup-close" bindtap="hideSortPanel">âœ•</text>
      </view>
      <view class="sort-list">
        <view class="sort-item {{selectedSort === item.label ? 'active' : ''}}" wx:for="{{sortOptions}}" wx:key="value" bindtap="onSortChange" data-value="{{item.value}}" data-label="{{item.label}}">
          <text>{{item.label}}</text>
          <text wx:if="{{selectedSort === item.label}}" class="check-icon">âœ“</text>
        </view>
      </view>
    </view>
  </view>
</view>
