<!--pages/school/list/list.wxml-->
<!-- 消息通知组件 -->
<message-notification />

<view class="container">
  <!-- 自定义导航栏 -->
  <custom-nav-bar showBack="{{true}}"></custom-nav-bar>
  <!-- 顶部图片 -->
  <view class="top-image-container">
    <image class="top-image" src="https://cni-alumni.yannqing.com/upload/images/2026/02/03/b6b97719-59ca-4c60-a006-b0f44eb4931c.png" mode="aspectFit" />
  </view>
  
  <!-- 搜索栏 -->
  <view class="search-bar">
    <view class="search-input-wrap">
      <image class="search-left-icon" src="{{iconSearch}}" mode="aspectFit" />
      <input class="search-input" type="text" placeholder="搜索母校名称、曾用名、合并院校名称" placeholder-style="color:rgba(255,255,255,0.7);font-family:'PingFang SC',sans-serif;" value="{{keyword}}" bindinput="onSearchInput" bindconfirm="onSearch" />
      <view class="search-button" bindtap="onSearch">搜索</view>
    </view>
  </view>

  <!-- 学校列表 -->
  <view class="association-list">
    <!-- 整合筛选区域 -->
    <view class="filter-section">
      <!-- 类型筛选 -->
      <view class="filter-item">
        <picker bindchange="onTypeChange" range="{{filters[0].options}}" value="{{filters[0].selected}}">
          <text>{{filters[0].options[filters[0].selected]}}</text>
        </picker>
        <text class="filter-arrow">▾</text>
      </view>
      <!-- 城市筛选 -->
      <view class="filter-item">
        <picker mode="multiSelector" range="{{regionData}}" value="{{regionIndex}}" bindchange="onRegionChange" bindcolumnchange="onRegionColumnChange">
          <text>{{regionDisplayText || '全部城市'}}</text>
        </picker>
        <text class="filter-arrow">▾</text>
      </view>
      <!-- 排序筛选 -->
      <view class="filter-item">
        <picker bindchange="onSortChange" range="{{filters[2].options}}" value="{{filters[2].selected}}">
          <text>{{filters[2].options[filters[2].selected]}}</text>
        </picker>
        <text class="filter-arrow">▾</text>
      </view>
      <!-- 关注筛选 -->
      <view class="filter-item">
        <picker bindchange="onFollowChange" range="{{filters[3].options}}" value="{{filters[3].selected}}">
          <text>{{filters[3].options[filters[3].selected]}}</text>
        </picker>
        <text class="filter-arrow">▾</text>
      </view>
    </view>

    <view class="association-card" wx:for="{{schoolList}}" wx:key="id" bindtap="viewDetail" data-id="{{item.id}}">
      <!-- 头部：图标、名称和认证标识 -->
      <view class="card-header">
        <view class="card-info">
          <view class="card-title-row">
            <text class="card-title">{{item.name}}</text>
            <view wx:if="{{item.isCertified}}" class="cert-badge">✓ 认证</view>
          </view>

          <!-- 学校信息 -->
          <view style="display: flex; align-items: center; margin-bottom: 12rpx;">
            <text wx:if="{{item.level}}" style="font-family: 'PingFang SC', 'PingFang SC Medium', sans-serif; font-size: 24rpx; color: #999999;">办学层次：{{item.level}}</text>
            <view class="card-location" style="margin-bottom: 0; flex-shrink: 0; margin-left: 38rpx;">
              <image class="location-icon" src="{{iconLocation}}" mode="aspectFit" />
              <text style="font-family: 'PingFang SC', 'PingFang SC Medium', sans-serif; font-size: 24rpx;">{{item.location}}</text>
            </view>
          </view>

          <!-- 关注按钮 -->
          <view class="card-action" catchtap="toggleFollow" data-id="{{item.id}}" data-followed="{{item.isFollowed}}">
            <view class="follow-btn {{item.isFollowed ? 'followed' : ''}}">
              {{item.isFollowed ? '已关注' : '+ 关注'}}
            </view>
          </view>
        </view>
        <image class="association-icon" src="{{item.icon}}" mode="aspectFill" />
      </view>

      <!-- 底部：统计数据 -->
      <view class="card-footer">
        <view class="card-stats">
          <text wx:if="{{item.associationCount > 0}}" class="stat-item">校友会 {{item.associationCount}}</text>
          <text wx:if="{{item.followCount > 0}}" class="stat-item">关注 {{item.followCount}}</text>
        </view>
      </view>
    </view>

    <!-- 加载状态 -->
    <view wx:if="{{loading}}" class="loading-text">加载中...</view>
    <view wx:elif="{{!hasMore}}" class="loading-text">没有更多了</view>

    <!-- 空状态 -->
    <view wx:if="{{!loading && schoolList.length === 0}}" class="empty-state">
      <view class="empty-placeholder">暂无数据</view>
      <text>暂无数据</text>
    </view>
  </view>
</view>
