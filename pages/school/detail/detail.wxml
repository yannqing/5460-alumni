<!--pages/school/detail/detail.wxml-->
<!-- 消息通知组件 -->
<message-notification />

<view class="container">
  <!-- 顶部固定区域 -->
  <view class="top-fixed-area">
    <!-- 自定义导航栏 -->
    <custom-nav-bar showBack="{{true}}"></custom-nav-bar>
    
    <!-- 顶部图片（与导航栏同一层级） -->
    <view class="top-image-container">
      <image class="top-image" src="https://cni-alumni.yannqing.com/upload/images/2026/02/03/76e9ae49-1c52-4587-be1c-91bc90e483f6.png" mode="aspectFit" />
    </view>
  </view>

  <!-- 内容滚动区域 -->
  <view class="content-scroll">
    <view wx:if="{{schoolInfo}}">
      <!-- 顶部背景图区域（包含学校信息） -->
      <view class="top-background-container">
        <image class="cover-image" src="{{schoolInfo.cover}}" mode="aspectFill" bindtap="previewImage" data-url="{{schoolInfo.cover}}" />
        <!-- 渐变遮罩 -->
        <view class="bg-gradient-overlay"></view>
        <!-- 学校头像 -->
        <image class="school-avatar-on-bg" src="{{schoolInfo.icon}}" mode="aspectFill" />
        <!-- 学校信息 -->
        <view class="school-info-on-bg">
          <text class="school-name-on-bg">{{schoolInfo.name}}</text>
          <view wx:if="{{schoolInfo.provinceCity}}" class="location-row-on-bg">
            <image class="location-icon-on-bg" src="{{iconLocation}}" mode="aspectFit" />
            <text>{{schoolInfo.provinceCity}}</text>
          </view>
        </view>
        <!-- 认证标签 -->
        <view class="cert-tag-wrap-on-bg">
          <view wx:if="{{schoolInfo.certifiedUnion}}" class="cert-tag" catchtap="viewCertifiedUnion">
            {{schoolInfo.certifiedUnion.name}}
          </view>
        </view>
      </view>

      <!-- 白色背景内容区域 -->
      <view class="white-background">

        <!-- 基本信息 -->
        <view class="card">
          <view class="text-bold mb-20">基本信息</view>
          
          <view wx:if="{{schoolInfo.description}}" class="text-secondary">{{schoolInfo.description}}</view>
          <view class="divider"></view>
          <view class="text-secondary">学校名称：{{schoolInfo.name}}</view>
          <view wx:if="{{schoolInfo.previousName}}" class="text-secondary mt-10">曾用名：{{schoolInfo.previousName}}</view>
          <view wx:if="{{schoolInfo.mergedInstitutions}}" class="text-secondary mt-10">合并院校：{{schoolInfo.mergedInstitutions}}</view>
          <view wx:if="{{schoolInfo.provinceCity}}" class="text-secondary mt-10">所在地：{{schoolInfo.provinceCity}}</view>
          <view wx:if="{{schoolInfo.location}}" class="text-secondary mt-10">详细地址：{{schoolInfo.location}}</view>
        </view>

        <!-- 校友会列表 -->
        <view class="card mt-20">
          <view class="text-bold mb-20">校友会</view>
          
          <view wx:if="{{associationList.length > 0}}" class="association-list">
            <view class="association-item" wx:for="{{associationList}}" wx:key="id">
              <view class="association-row" bindtap="viewAssociationDetail" data-id="{{item.id}}">
                <image class="association-icon" src="{{item.icon}}" mode="aspectFill" />
                <view class="association-info">
                  <view class="association-name-row">
                    <text class="association-name">{{item.name}}</text>
                    <view wx:if="{{item.isCertified}}" class="certified-badge-small">✓ 认证</view>
                  </view>
                  <view class="association-meta">
                    <view class="association-location">
                      <image class="location-icon-small" src="{{iconLocation}}" mode="aspectFit" />
                      <text>{{item.location}}</text>
                    </view>
                    <text class="association-members">{{item.memberCount}}人</text>
                  </view>
                </view>
              </view>
              <view class="association-action" catchtap="toggleJoinAssociation" data-id="{{item.id}}">
                <view class="join-btn {{item.isJoined ? 'joined' : ''}}">
                  {{item.isJoined ? '已加入' : '加入'}}
                </view>
              </view>
            </view>
          </view>
          
          <view wx:else class="empty-association">
            <text class="empty-text">暂无校友会</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
