<!--pages/school/detail/detail.wxml-->
<view class="container">
  <view wx:if="{{loading}}" class="loading-wrap">
    <view class="loading">åŠ è½½ä¸­...</view>
  </view>

  <view wx:else>
    <!-- å°é¢å›¾ -->
    <view class="cover-section">
      <image class="cover-image" src="{{schoolInfo.cover}}" mode="aspectFill" bindtap="previewImage" data-url="{{schoolInfo.cover}}" />
      <view class="cover-overlay">
        <view class="school-basic">
          <image class="school-icon-large" src="{{schoolInfo.icon}}" mode="aspectFill" />
          <view class="school-basic-info">
            <view class="school-name-row">
              <text class="school-name-large">{{schoolInfo.name}}</text>
              <view wx:if="{{schoolInfo.isCertified}}" class="certified-badge-large">âœ“</view>
            </view>
            <view class="school-location-large">ğŸ“ {{schoolInfo.location}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-bar">
      <view class="action-btn" bindtap="toggleFollow">
        <text class="action-icon">{{schoolInfo.isFollowed ? 'â˜…' : 'â˜†'}}</text>
        <text class="action-text">{{schoolInfo.isFollowed ? 'å·²å…³æ³¨' : 'å…³æ³¨'}}</text>
      </view>
      <view class="action-btn" bindtap="makeCall">
        <text class="action-icon">ğŸ“</text>
        <text class="action-text">ç”µè¯</text>
      </view>
      <view class="action-btn" button open-type="share">
        <text class="action-icon">ğŸ”—</text>
        <text class="action-text">åˆ†äº«</text>
      </view>
    </view>

    <!-- é€‰é¡¹å¡ -->
    <view class="tabs">
      <view class="tab-item {{activeTab === index ? 'active' : ''}}" wx:for="{{tabs}}" wx:key="*this" bindtap="switchTab" data-index="{{index}}">
        {{item}}
      </view>
    </view>

    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view wx:if="{{activeTab === 0}}" class="tab-content">
      <view class="info-section card">
        <view class="section-title-small">åŸºæœ¬ä¿¡æ¯</view>

        <view class="info-row">
          <view class="info-label">å­¦æ ¡åç§°</view>
          <view class="info-value">{{schoolInfo.name}}</view>
        </view>

        <view wx:if="{{schoolInfo.oldNames && schoolInfo.oldNames.length > 0}}" class="info-row">
          <view class="info-label">æ›¾ç”¨å</view>
          <view class="info-value">{{schoolInfo.oldNames.join('ã€')}}</view>
        </view>

        <view class="info-row">
          <view class="info-label">åˆ›å»ºå¹´ä»½</view>
          <view class="info-value">{{schoolInfo.foundedYear}}å¹´</view>
        </view>

        <view class="info-row">
          <view class="info-label">æ‰€åœ¨åœ°</view>
          <view class="info-value">{{schoolInfo.location}}</view>
        </view>

        <view class="info-row">
          <view class="info-label">æ ‡ç­¾</view>
          <view class="info-value">
            <text class="tag" wx:for="{{schoolInfo.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
          </view>
        </view>

        <view class="info-row">
          <view class="info-label">æ ¡å‹æ•°é‡</view>
          <view class="info-value theme-color">{{schoolInfo.alumniCount}}äºº</view>
        </view>

        <view class="info-row">
          <view class="info-label">æ ¡å‹ä¼šæ•°é‡</view>
          <view class="info-value theme-color">{{schoolInfo.associationCount}}ä¸ª</view>
        </view>

        <view class="info-row">
          <view class="info-label">å®˜æ–¹ç½‘ç«™</view>
          <view class="info-value link-text" bindtap="copyWebsite">{{schoolInfo.website}}</view>
        </view>

        <view class="info-row">
          <view class="info-label">è”ç³»ç”µè¯</view>
          <view class="info-value link-text" bindtap="makeCall">{{schoolInfo.phone}}</view>
        </view>
      </view>

      <view class="info-section card">
        <view class="section-title-small">å­¦æ ¡ç®€ä»‹</view>
        <view class="description-text">{{schoolInfo.description}}</view>
      </view>
    </view>

    <!-- æ ¡å‹ä¼šåˆ—è¡¨ -->
    <view wx:if="{{activeTab === 1}}" class="tab-content">
      <view class="association-section">
        <view class="section-header-inline">
          <view class="section-title-small">åŒ…å«çš„æ ¡å‹ä¼š</view>
          <view class="section-more-inline" bindtap="viewAllAssociations">
            <text>æŸ¥çœ‹å…¨éƒ¨</text>
            <text class="arrow">â€º</text>
          </view>
        </view>

        <view class="association-list">
          <view class="association-item-card card" wx:for="{{associations}}" wx:key="id" bindtap="viewAssociationDetail" data-id="{{item.id}}">
            <view class="association-item-header">
              <view class="association-item-info">
                <view class="association-item-name">{{item.name}}</view>
                <view class="association-item-meta">
                  <text>{{item.location}}</text>
                  <text class="dot">â€¢</text>
                  <text>{{item.memberCount}}äºº</text>
                </view>
                <view class="association-item-detail">
                  <text>ä¼šé•¿ï¼š{{item.president}}</text>
                  <text class="dot">â€¢</text>
                  <text>æˆç«‹äº{{item.establishedYear}}å¹´</text>
                </view>
              </view>
              <view class="association-item-action">
                <view class="btn btn-small {{item.isJoined ? 'btn-plain' : 'btn-primary'}}">
                  {{item.isJoined ? 'å·²åŠ å…¥' : 'åŠ å…¥'}}
                </view>
              </view>
            </view>
          </view>
        </view>

        <view wx:if="{{associations.length === 0}}" class="empty-state">
          <image src="https://via.placeholder.com/200/f0f0f0/999999?text=Empty" mode="aspectFill" />
          <text>æš‚æ— æ ¡å‹ä¼š</text>
        </view>
      </view>
    </view>

    <!-- æ ¡å‹æ€»ä¼š -->
    <view wx:if="{{activeTab === 2}}" class="tab-content">
      <view class="union-section card" wx:if="{{alumniUnion}}" bindtap="viewAlumniUnion">
        <view class="union-header">
          <image class="union-icon" src="{{alumniUnion.icon}}" mode="aspectFill" />
          <view class="union-info">
            <view class="union-name-row">
              <text class="union-name">{{alumniUnion.name}}</text>
              <view wx:if="{{alumniUnion.isCertified}}" class="certified-badge">âœ“ è®¤è¯ä¸»ä½“</view>
            </view>
            <view class="union-desc">{{alumniUnion.description}}</view>
          </view>
        </view>

        <view class="union-contact">
          <view class="contact-item">
            <text class="contact-label">å®˜æ–¹ç½‘ç«™ï¼š</text>
            <text class="contact-value">{{alumniUnion.website}}</text>
          </view>
          <view class="contact-item">
            <text class="contact-label">è”ç³»ç”µè¯ï¼š</text>
            <text class="contact-value">{{alumniUnion.phone}}</text>
          </view>
          <view class="contact-item">
            <text class="contact-label">ç”µå­é‚®ç®±ï¼š</text>
            <text class="contact-value">{{alumniUnion.email}}</text>
          </view>
          <view class="contact-item">
            <text class="contact-label">å¾®ä¿¡å…¬ä¼—å·ï¼š</text>
            <text class="contact-value">{{alumniUnion.wechat}}</text>
          </view>
        </view>

        <view wx:if="{{alumniUnion.hasApp}}" class="union-tip">
          <text class="tip-icon">ğŸ’¡</text>
          <text class="tip-text">ç‚¹å‡»å¯è·³è½¬åˆ°æ ¡å‹æ€»ä¼šå°ç¨‹åº</text>
        </view>
      </view>

      <view wx:else class="empty-state">
        <image src="https://via.placeholder.com/200/f0f0f0/999999?text=Empty" mode="aspectFill" />
        <text>æš‚æ— æ ¡å‹æ€»ä¼šä¿¡æ¯</text>
      </view>
    </view>
  </view>
</view>
