<!--pages/benefit/list/list.wxml-->
<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<custom-nav-bar title="é™„è¿‘æƒç›Š" showBack="{{true}}"></custom-nav-bar>

<view class="benefit-page">
  <view class="hero-card">
    <view class="hero-top">
      <view class="hero-location">
        <text class="hero-label">é™„è¿‘æƒç›Š</text>
        <view class="location-row">
          <text class="location-city">{{location.name}}</text>
          <text class="location-distance">{{location.distance}}</text>
        </view>
      </view>
      <view class="refresh-btn" bindtap="refreshPage">åˆ·æ–°</view>
    </view>

    <view class="search-bar">
      <text class="search-icon">ğŸ”</text>
      <input
        class="search-input"
        placeholder="æœç´¢å•†æˆ· / æƒç›Š / æ ‡ç­¾"
        value="{{searchValue}}"
        confirm-type="search"
        bindinput="handleSearchInput"
        bindconfirm="handleSearchConfirm"
      />
      <view class="search-action" bindtap="handleSearchConfirm">æœç´¢</view>
    </view>

    <view class="hero-stats">
      <view class="stats-item">
        <text class="stats-value">{{stats.total}}</text>
        <text class="stats-label">å¯ç”¨æƒç›Š</text>
      </view>
      <view class="stats-item">
        <text class="stats-value">{{stats.newArrivals}}</text>
        <text class="stats-label">ä»Šæ—¥ä¸Šæ–°</text>
      </view>
      <view class="stats-item">
        <text class="stats-value">{{stats.remindCount}}</text>
        <text class="stats-label">å·²è®¾ç½®æé†’</text>
      </view>
    </view>
  </view>

  <scroll-view class="category-bar" scroll-x enable-flex>
    <view
      wx:for="{{categories}}"
      wx:key="id"
      wx:for-item="item"
      class="category-chip {{selectedCategory === item.id ? 'active' : ''}}"
      data-id="{{item.id}}"
      bindtap="handleCategoryChange"
    >
      {{item.label}}
    </view>
  </scroll-view>

  <view class="sort-row">
    <view
      class="sort-option {{sortType === option.id ? 'active' : ''}}"
      wx:for="{{sortOptions}}"
      wx:key="id"
      wx:for-item="option"
      data-id="{{option.id}}"
      bindtap="handleSortChange"
    >
      {{option.label}}
    </view>
    <view class="sort-extra" bindtap="getLocation">é‡æ–°å®šä½</view>
  </view>

  <view class="benefit-list">
    <block wx:if="{{loading}}">
      <view class="skeleton-card" wx:for="{{[1,2,3]}}" wx:key="*this">
        <view class="skeleton-line wide"></view>
        <view class="skeleton-line"></view>
        <view class="skeleton-tags">
          <view class="skeleton-tag"></view>
          <view class="skeleton-tag"></view>
        </view>
      </view>
    </block>

    <block wx:elif="{{displayList.length}}">
      <view class="benefit-card" wx:for="{{displayList}}" wx:key="id">
        <view class="card-cover" bindtap="viewDetail" data-id="{{item.id}}">
          <image src="{{item.cover}}" mode="aspectFill"></image>
          <view wx:if="{{item.isNew}}" class="badge badge-new">ä¸Šæ–°</view>
          <view class="badge badge-distance">{{item.distance}}m</view>
          <view
            class="favorite {{item.favorite ? 'fav-on' : ''}}"
            data-id="{{item.id}}"
            catchtap="toggleFavorite"
          >
            {{item.favorite ? 'â™¥' : 'â™¡'}}
          </view>
        </view>

        <view class="card-content">
          <view class="card-title" bindtap="viewDetail" data-id="{{item.id}}">
            {{item.title}}
          </view>
          <view class="card-merchant" data-merchant="{{item.merchant}}" bindtap="goToMerchant">
            {{item.merchant}}
          </view>
          <view class="card-tags">
            <view class="tag discount">{{item.discount}}</view>
            <view
              class="tag"
              wx:for="{{item.tags}}"
              wx:for-item="tag"
              wx:key="*this"
            >
              {{tag}}
            </view>
          </view>
          <view class="card-footer">
            <view class="expire">æœ‰æ•ˆæœŸè‡³ {{item.expireDate}}</view>
            <view class="popularity">çƒ­åº¦ {{item.popularity}}</view>
          </view>
        </view>

        <view class="card-actions">
          <view
            class="action-btn remind {{item.remindSet ? 'active' : ''}}"
            catchtap="toggleRemind"
            data-id="{{item.id}}"
          >
            {{item.remindSet ? 'å–æ¶ˆæé†’' : 'åˆ°æœŸæé†’'}}
          </view>
          <view class="action-btn detail" bindtap="viewDetail" data-id="{{item.id}}">
            å¯äº«ä¼˜æƒ 
          </view>
        </view>
      </view>
    </block>

    <view class="empty-state" wx:else>
      <image class="empty-img" src="https://cdn.example.com/empty-benefit.png" mode="widthFix"></image>
      <text class="empty-text">æš‚æ— ç¬¦åˆæ¡ä»¶çš„æƒç›Š</text>
      <view class="empty-btn" bindtap="refreshPage">é‡ç½®ç­›é€‰</view>
    </view>
  </view>
</view>

