<!--pages/discover/discover.wxml-->
<view class="discover-page">
  <!-- è“è‰²å¤´éƒ¨ -->
  <view class="header-section">
    <view class="header-section-inner">
      <view class="header-top-row">
        <view class="logo-placeholder">logo</view>
      </view>
      <view class="search-container">
        <text class="search-icon">ğŸ”</text>
        <input
          class="search-input"
          placeholder="æœç´¢é™„è¿‘ä¼˜æƒ ã€åœºæ‰€ã€æ ¡å‹ã€æ´»åŠ¨"
          value="{{searchValue}}"
          confirm-type="search"
          bindinput="handleSearchInput"
          bindconfirm="handleSearchConfirm"
        />
        <view class="search-btn" bindtap="handleSearchConfirm">æœç´¢</view>
      </view>
      <view class="header-subtitle">silogn</view>
    </view>
  </view>

  <!-- å¯¼èˆªæ ‡ç­¾ -->
  <view class="nav-tabs">
    <view
      class="nav-tab {{selectedTab === item.id ? 'active' : ''}}"
      wx:for="{{navTabs}}"
      wx:key="id"
      data-id="{{item.id}}"
      bindtap="handleTabChange"
    >
      <text class="tab-icon">{{item.icon}}</text>
      <text class="tab-text">{{item.label}}</text>
    </view>
  </view>

  <!-- è§†å›¾åˆ‡æ¢å’Œæ’åº -->
  <view class="view-sort-container">
    <view class="view-toggle">
      <view
        class="toggle-item {{viewMode === 'map' ? 'active' : ''}}"
        bindtap="switchViewMode"
        data-mode="map"
      >
        <text class="toggle-icon">ğŸ—ºï¸</text>
        <text class="toggle-text">åœ°å›¾</text>
      </view>
      <view
        class="toggle-item {{viewMode === 'list' ? 'active' : ''}}"
        bindtap="switchViewMode"
        data-mode="list"
      >
        <text class="toggle-icon">ğŸ“‹</text>
        <text class="toggle-text">åˆ—è¡¨</text>
      </view>
    </view>
    <view class="sort-divider"></view>
    <view class="sort-options">
      <view
        class="sort-item {{sortType === item.id ? 'active' : ''}}"
        wx:for="{{sortOptions}}"
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="handleSortChange"
      >
        {{item.label}}
      </view>
    </view>
  </view>

  <!-- åˆ—è¡¨è§†å›¾ -->
  <view class="list-view" wx:if="{{viewMode === 'list'}}">

    <!-- å†…å®¹åˆ—è¡¨ -->
    <view class="content-list">
      <!-- æ ¡å‹å¡ç‰‡ -->
      <view class="content-card" wx:for="{{alumniList}}" wx:key="id">
        <view class="card-avatar">
          <image class="avatar-img" src="{{item.avatar}}" mode="aspectFill" wx:if="{{item.avatar}}"></image>
        </view>
        <view class="card-content">
          <view class="card-name">{{item.name}}</view>
          <view class="card-distance">è·ç¦» {{item.distance}}m</view>
          <view class="card-association">{{item.association}}</view>
          <view class="card-tag" wx:if="{{item.tag}}">{{item.tag}}</view>
        </view>
        <view class="card-action">
          <view class="follow-btn" bindtap="handleFollow" data-id="{{item.id}}">å…³æ³¨</view>
        </view>
      </view>

      <!-- æ´»åŠ¨å¡ç‰‡ -->
      <view class="activity-card" wx:for="{{activityList}}" wx:key="id">
        <view class="activity-title">{{item.title}}</view>
        <view class="activity-date">{{item.dateRange}}</view>
        <view class="activity-association">{{item.association}}</view>
        <view class="activity-participants">
          <view class="participant-avatars">
            <view class="participant-avatar" wx:for="{{item.participantAvatars}}" wx:key="*this" wx:for-item="avatar" wx:for-index="idx">
              <image class="avatar-small" src="{{avatar}}" mode="aspectFill" wx:if="{{avatar}}"></image>
            </view>
          </view>
          <text class="participant-text">ç­‰{{item.participantCount}}ä½æ ¡å‹å·²ç»å‚ä¸</text>
        </view>
        <view class="activity-actions">
          <view class="signup-btn" bindtap="handleSignup" data-id="{{item.id}}">æˆ‘è¦æŠ¥å</view>
        </view>
        <view class="activity-footer">
          <text class="activity-location">{{item.location}}</text>
          <view class="activity-icons">
            <view class="icon-item" bindtap="handleLike" data-id="{{item.id}}">
              <text class="icon-like">ğŸ‘</text>
            </view>
            <view class="icon-item" bindtap="handleShare" data-id="{{item.id}}">
              <text class="icon-share">ğŸ“¤</text>
            </view>
          </view>
        </view>
        <view class="activity-status" wx:if="{{item.signedUp}}">
          <view class="signed-btn">å·²æŠ¥å</view>
          <text class="signed-count">{{item.signedCount}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åœ°å›¾è§†å›¾ -->
  <view class="map-view" wx:if="{{viewMode === 'map'}}">
    <map
      id="discoverMap"
      class="discover-map"
      latitude="{{mapCenter.latitude}}"
      longitude="{{mapCenter.longitude}}"
      scale="{{mapScale}}"
      markers="{{mapMarkers}}"
      bindmarkertap="onMarkerTap"
      bindtap="onMapTap"
    ></map>
  </view>
</view>
