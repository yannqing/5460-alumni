<!--pages/discover/discover.wxml-->
<view class="discover-page">
  <!-- é¡¶éƒ¨æœç´¢æ  -->
  <view class="hero-card">
    <view class="search-bar">
      <image class="search-icon-img" src="/assets/icons/æœç´¢.png" mode="aspectFit"></image>
      <input
        class="search-input"
        placeholder="æœç´¢å•†å®¶ / ä¼˜æƒ åˆ¸ / æ´»åŠ¨"
        value="{{searchValue}}"
        confirm-type="search"
        bindinput="handleSearchInput"
        bindconfirm="handleSearchConfirm"
      />
      <view class="search-action" bindtap="handleSearchConfirm">æœç´¢</view>
    </view>

    <view class="hero-stats">
      <view class="stats-item">
        <text class="stats-value">{{stats.merchantCount}}</text>
        <text class="stats-label">åˆä½œå•†å®¶</text>
      </view>
      <view class="stats-item">
        <text class="stats-value">{{stats.couponCount}}</text>
        <text class="stats-label">å¯ç”¨ä¼˜æƒ åˆ¸</text>
      </view>
      <view class="stats-item">
        <text class="stats-value">{{stats.activityCount}}</text>
        <text class="stats-label">è¿›è¡Œä¸­æ´»åŠ¨</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»ç­›é€‰ -->
  <scroll-view class="category-bar" scroll-x enable-flex>
    <view
      class="category-chip {{selectedCategory === item.id ? 'active' : ''}}"
      wx:for="{{categories}}"
      wx:key="id"
      data-id="{{item.id}}"
      bindtap="handleCategoryChange"
    >
      {{item.label}}
    </view>
  </scroll-view>

  <!-- æ’åºé€‰é¡¹ -->
  <view class="sort-row">
    <view
      class="sort-option {{sortType === option.id ? 'active' : ''}}"
      wx:for="{{sortOptions}}"
      wx:key="id"
      wx:for-item="option"
      data-id="{{option.id}}"
      bindtap="handleSortChange"
    >
      {{option.label}}
    </view>
    <view class="sort-extra" bindtap="getLocation">é‡æ–°å®šä½</view>
  </view>

  <!-- å•†å®¶åˆ—è¡¨ -->
  <view class="merchant-list">
    <block wx:if="{{loading}}">
      <view class="skeleton-card" wx:for="{{[1,2,3]}}" wx:key="*this">
        <view class="skeleton-line wide"></view>
        <view class="skeleton-line"></view>
        <view class="skeleton-tags">
          <view class="skeleton-tag"></view>
          <view class="skeleton-tag"></view>
        </view>
      </view>
    </block>

    <block wx:elif="{{displayList.length}}">
      <view class="merchant-card" wx:for="{{displayList}}" wx:key="id" bindtap="viewMerchantCoupons" data-id="{{item.id}}">
        <view class="merchant-header">
          <image class="merchant-avatar" src="{{item.avatar}}" mode="aspectFill" bindtap="viewMerchantDetail" data-id="{{item.id}}" catchtap="true"></image>
          <view class="merchant-info">
            <view class="merchant-name-row">
              <text class="merchant-name">{{item.name}}</text>
              <view wx:if="{{item.isCertified}}" class="cert-badge-small">âœ“</view>
            </view>
            <view class="merchant-meta">
              <text class="merchant-location">ğŸ“ {{item.location}}</text>
              <text class="meta-divider">Â·</text>
              <text class="merchant-distance">è·ç¦» {{item.distance}}m</text>
              <text class="meta-divider">Â·</text>
              <text class="merchant-rating">â­ {{item.rating}}</text>
            </view>
          </view>
        </view>
        <scroll-view class="merchant-coupons" scroll-x>
          <view class="coupon-item" wx:for="{{item.coupons}}" wx:key="id" wx:for-item="coupon" bindtap="viewCouponDetail" data-id="{{coupon.id}}" catchtap="true">
            <view class="coupon-card-mini">
              <view class="coupon-left">
                <view class="coupon-discount-large">{{coupon.discount}}</view>
                <view class="coupon-label">ä¼˜æƒ åˆ¸</view>
              </view>
              <view class="coupon-divider"></view>
              <view class="coupon-right">
                <view class="coupon-title-mini">{{coupon.title}}</view>
                <view class="coupon-expire-mini">æœ‰æ•ˆæœŸè‡³ {{coupon.expireDate}}</view>
              </view>
            </view>
          </view>
        </scroll-view>
      </view>
    </block>

    <view class="empty-state" wx:else>
      <image class="empty-img" src="https://cdn.example.com/empty-benefit.png" mode="widthFix"></image>
      <text class="empty-text">æš‚æ— ç¬¦åˆæ¡ä»¶çš„å•†å®¶</text>
      <view class="empty-btn" bindtap="refreshPage">é‡ç½®ç­›é€‰</view>
    </view>
  </view>
</view>
