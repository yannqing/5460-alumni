<!--pages/profile/profile.wxml-->
<!-- 消息通知组件 -->
<message-notification />

<view class="page">
  <!-- 顶部背景区域 -->
  <view class="box_6" style="background-image: url({{imageTopBg}}); padding-top: {{statusBarHeight}}px;">
    <!-- 时间显示 (已移除) -->
    <!-- <view class="text-wrapper_5">
      <text lines="1" class="text_3">{{currentTime}}</text>
    </view> -->
    
    <!-- 编辑资料按钮 -->
    <view class="text-wrapper_6" bindtap="editProfile">
      <text lines="1" decode="true" class="text_4">编辑资料&nbsp;&gt;</text>
    </view>

    <!-- 装饰背景层 section_1 -->
    <view class="section_1">
      <view class="image-wrapper_6">
      </view>
    </view>

    <!-- 个人中心标题和用户名 section_2 -->
    <view class="section_2">
      <view class="text-wrapper_7">
        <text lines="1" class="text_5">个人中心</text>
      </view>
      <view class="text-wrapper_8">
        <text lines="1" class="text_6">{{userInfo.nickname || '用户名'}}</text>
      </view>
    </view>

    <!-- 头像 -->
    <view class="image-wrapper_7" bindtap="editProfile">
      <image src="{{userInfo.avatarUrl || '/assets/default-avatar.png'}}" class="image_12"></image>
    </view>

    <!-- 校友会认证徽章 -->
    <view class="section_3" wx:if="{{userInfo.isAlumni === 1}}">
      <text lines="1" class="text_7">校友会认证</text>
      <view class="group_12"></view>
    </view>
  </view>

  <!-- 下方内容区域 -->
  <view class="block_1">
    <!-- 统计数据 -->
    <view class="list_4">
      <view class="text-group_9-0" bindtap="goToMyFollow">
        <text lines="1" class="text_8-0">{{followStats.followingCount || 0}}</text>
        <text lines="1" class="text_9-0">关注</text>
      </view>
      <view class="text-group_9-1" bindtap="goToMyFans">
        <text lines="1" class="text_8-1">{{followStats.fansCount || 0}}</text>
        <text lines="1" class="text_9-1">粉丝</text>
      </view>
      <view class="text-group_9-2" bindtap="navigateTo" data-url="/pages/footprint/footprint">
        <text lines="1" class="text_8-2">{{stats.footprints || 0}}</text>
        <text lines="1" class="text_9-2">足迹</text>
      </view>
      <view class="text-group_9-3" bindtap="navigateTo" data-url="/pages/coupon/list/list?type=my">
        <text lines="1" class="text_8-3">{{stats.coupons || 0}}</text>
        <text lines="1" class="text_9-3">卡券</text>
      </view>
    </view>

    <!-- Banner图片 / 完善信息提示 -->
    <block wx:if="{{userInfo && userInfo.realName && userInfo.realName !== ''}}">
      <image src="{{imageBanner}}" class="image_13" mode="widthFix"></image>
    </block>
    <view class="complete-profile-banner" wx:else>
      <view class="complete-profile-text-group">
        <text class="complete-profile-text-regular">完善个人信息，享受</text>
        <text class="complete-profile-text-bold">更多权益</text>
      </view>
      <view class="complete-profile-btn" bindtap="editProfile">
        <text class="complete-profile-btn-text">完善个人信息</text>
      </view>
    </view>

    <!-- 常用功能 -->
    <view class="section_4">
      <text lines="1" class="text_10">常用功能</text>
      <view class="list_5">
        <view class="image-text_9-0" wx:if="{{hasManagementPermission}}" bindtap="navigateTo" data-url="/pages/audit/index/index">
          <image src="{{iconGlrk}}" class="label_10-0"></image>
          <text lines="1" class="text-group_3-0">管理入口</text>
        </view>
        <view class="image-text_8-3" bindtap="navigateTo" data-url="/pages/profile/my-card/my-card">
          <image src="{{iconWdsc}}" class="label_9-3"></image>
          <text lines="1" class="text-group_2-3">我的名片</text>
        </view>
        <view class="image-text_8-2">
          <image src="{{iconWdsc}}" class="label_9-2"></image>
          <text lines="1" class="text-group_2-2">我的收藏</text>
          <view class="construction-tag">建设中</view>
        </view>
        <view class="image-text_9-3" bindtap="navigateTo" data-url="/pages/profile/privacy/privacy">
          <image src="{{iconGrys}}" class="label_10-3"></image>
          <text lines="1" class="text-group_3-3">个人隐私</text>
        </view>
      </view>
    </view>

    <!-- 其他功能 -->
    <view class="section_5">
      <text lines="1" class="text_11">其他功能</text>
      <view class="list_6">
        <view class="image-text_8-0" bindtap="navigateTo" data-url="/pages/coupon/list/list?type=my&tab=unused">
          <image src="{{iconWdjb}}" class="label_9-0"></image>
          <text lines="1" class="text-group_2-0">我的券包</text>
        </view>
        <view class="image-text_8-1" bindtap="navigateTo" data-url="/pages/profile/alumni-association/alumni-association">
          <image src="{{iconSwhz}}" class="label_9-1"></image>
          <text lines="1" class="text-group_2-1">我的校友会</text>
        </view>
        <view class="image-text_9-1" bindtap="navigateTo" data-url="/pages/merchant/my-merchant/my-merchant">
          <image src="{{iconSwhz}}" class="label_10-1"></image>
          <text lines="1" class="text-group_3-1">我的商户</text>
        </view>
        <view class="image-text_9-2" bindtap="navigateTo" data-url="/pages/enterprise/my-enterprise/my-enterprise">
          <image src="{{iconSwhz}}" class="label_10-2"></image>
          <text lines="1" class="text-group_3-2">我的企业</text>
        </view>
      </view>
      <view class="image-text_10" wx:if="{{couponStats.unused > 0}}" bindtap="navigateTo" data-url="/pages/coupon/list/list?type=my&tab=unused">
        <image src="{{iconWdjb}}" class="label_11"></image>
        <text lines="1" class="text-group_4">券包({{couponStats.unused}})</text>
      </view>
    </view>
  </view>
</view>

<!-- 校友卡弹窗 -->
<view class="alumni-card-modal" wx:if="{{showCardModal}}" bindtap="hideAlumniCard">
  <view class="alumni-card-content" catchtap="true">
    <view class="alumni-card-header">
      <text class="card-title">校友卡</text>
      <text class="close-btn" bindtap="hideAlumniCard">×</text>
    </view>
    <view class="alumni-card-body">
      <image class="card-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
      <view class="card-name">{{userInfo.nickname}}</view>
      <view class="card-school">{{userInfo.school}} · {{userInfo.graduateYear}}级</view>
      <view class="card-qrcode">
        <image src="{{alumniCardQrcode}}" mode="aspectFit"></image>
      </view>
      <view class="card-number">校友卡号：{{alumniCardNumber}}</view>
    </view>
  </view>
</view>