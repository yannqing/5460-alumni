<!--pages/merchant/list/list.wxml-->
<!-- 消息通知组件 -->
<message-notification />

<view class="container">
  <!-- 固定顶部背景 -->
  <view class="fixed-top-bg"></view>
  <!-- 自定义导航栏 -->
  <custom-nav-bar showBack="{{true}}"></custom-nav-bar>
  <!-- 顶部图片 -->
  <view class="top-image-container">
    <image class="top-image" src="https://cni-alumni.yannqing.com/upload/images/2026/02/09/ec78b300-ab01-470d-a504-97eb149caf24.png" mode="aspectFit" />
  </view>
  
  <!-- 搜索栏和筛选条件容器 -->
  <view class="header-container">
    <!-- 搜索栏 -->
    <view class="search-bar">
      <view class="search-input-wrap">
        <image class="search-left-icon" src="../../../assets/icons/magnifying glass.png" mode="aspectFit" />
        <input class="search-input" type="text" placeholder="搜索商铺名称" placeholder-style="color:rgba(255,255,255,0.7);font-family:'PingFang SC',sans-serif;" value="{{keyword}}" bindinput="onSearchInput" bindconfirm="onSearch" />
        <view class="search-button" bindtap="onSearch">搜索</view>
      </view>
    </view>
    
    <!-- 筛选栏 -->
    <view class="filter-bar">
      <!-- 商铺类型筛选 -->
      <view class="filter-item">
        <picker bindchange="onTypeChange" range="{{filters[0].options}}" value="{{filters[0].selected}}">
          <text>{{filters[0].options[filters[0].selected]}}</text>
        </picker>
        <text class="filter-arrow">▾</text>
      </view>
      <!-- 会员等级筛选 -->
      <view class="filter-item">
        <picker bindchange="onTierChange" range="{{filters[1].options}}" value="{{filters[1].selected}}">
          <text>{{filters[1].options[filters[1].selected]}}</text>
        </picker>
        <text class="filter-arrow">▾</text>
      </view>
      <!-- 业务类别筛选 -->
      <view class="filter-item">
        <picker bindchange="onCategoryChange" range="{{filters[2].options}}" value="{{filters[2].selected}}">
          <text>{{filters[2].options[filters[2].selected]}}</text>
        </picker>
        <text class="filter-arrow">▾</text>
      </view>
      <!-- 校友认证筛选 -->
      <view class="filter-item">
        <picker bindchange="onCertChange" range="{{filters[3].options}}" value="{{filters[3].selected}}">
          <text>{{filters[3].options[filters[3].selected]}}</text>
        </picker>
        <text class="filter-arrow">▾</text>
      </view>
    </view>
  </view>

  <!-- 商铺列表 -->
  <view class="merchant-list">
    <view class="merchant-card" wx:for="{{merchantList}}" wx:key="merchantId" bindtap="viewDetail" data-id="{{item.merchantId}}">
      <!-- 头部：商铺名称和会员等级 -->
      <view class="card-header">
        <view class="card-info">
          <view class="card-title-row">
            <text class="card-title">{{item.merchantName}}</text>
            <view wx:if="{{item.memberTier > 0}}" class="tier-badge tier-{{item.memberTier}}">
              {{item.tierName}}
            </view>
            <view wx:if="{{item.isAlumniCertified === 1}}" class="cert-badge">✓ 校友认证</view>
          </view>

          <!-- 业务类别 -->
          <view class="card-subtitle" wx:if="{{item.businessCategory}}">
            <image class="subtitle-icon" src="{{iconCategory}}" mode="aspectFit" />
            <text>{{item.businessCategory}}</text>
          </view>

          <!-- 评分信息 -->
          <view class="card-rating" wx:if="{{item.ratingScore > 0}}">
            <image class="rating-icon" src="{{iconStar}}" mode="aspectFit" />
            <text class="rating-score">{{item.ratingScore}}</text>
            <text class="rating-count">({{item.ratingCount}}条评价)</text>
          </view>

          <!-- 商铺数量 -->
          <view class="card-stats">
            <view class="stat-item">
              <text class="stat-label">门店：</text>
              <text class="stat-value">{{item.shopCount}}家</text>
            </view>
            
          </view>
        </view>
      </view>
    </view>

    <!-- 加载状态 -->
    <view wx:if="{{loading}}" class="loading-text">加载中...</view>
    <view wx:elif="{{!hasMore}}" class="loading-text">没有更多了</view>

    <!-- 空状态 -->
    <view wx:if="{{!loading && merchantList.length === 0}}" class="empty-state">
      <view class="empty-placeholder">暂无数据</view>
      <text>暂无数据</text>
    </view>
  </view>
</view>