<!--pages/audit/user/list/list.wxml-->
<custom-nav-bar showBack="{{true}}" useAuditStyle="{{true}}" auditTitle="文章审核">
<view class="page">
  <!-- 标签栏 - 固定 -->
  <view class="section_8">
    <view 
      class="text-wrapper_14 {{currentTab === 0 ? 'active' : ''}}"
      data-index="0"
      bindtap="switchTab"
    >
      <text lines="1" class="text_28">全部</text>
    </view>
    <view 
      class="text-wrapper_14 {{currentTab === 1 ? 'active' : ''}}"
      data-index="1"
      bindtap="switchTab"
    >
      <text lines="1" class="text_28">待审核</text>
    </view>
    <view 
      class="text-wrapper_14 {{currentTab === 2 ? 'active' : ''}}"
      data-index="2"
      bindtap="switchTab"
    >
      <text lines="1" class="text_28">已审核</text>
    </view>
  </view>

  <!-- 可滚动列表区域 -->
  <scroll-view 
    class="scroll-list" 
    scroll-y 
    bindscrolltolower="onReachBottom"
    lower-threshold="100"
    enable-back-to-top
    show-scrollbar="{{false}}"
  >
    <!-- 文章列表 -->
    <view class="article-list">
    <block wx:for="{{articleList}}" wx:key="id">
      <!-- 待审核状态 -->
      <view class="box_5" wx:if="{{item.status === 'pending'}}">
        <view class="block_12">
          <view class="block_13">
            <view class="box_8">
              <text lines="1" class="text_17">{{item.nickname}}</text>
              <view class="text-wrapper_8">
                <text lines="1" class="text_18">待审核</text>
              </view>
            </view>
            <view class="text-wrapper_15">
              <text lines="1" class="text_19">提交时间：</text>
              <text lines="1" class="text_20">{{item.submitTime}}</text>
            </view>
          </view>
          <image class="image_6" src="{{item.coverImg}}" mode="aspectFill" wx:if="{{item.coverImg}}"></image>
          <view class="image_6 placeholder" wx:else></view>
        </view>
        <view class="block_14">
          <view class="text-wrapper_10" catchtap="onApproveTap" data-id="{{item.id}}">
            <text lines="1" class="text_21">通过</text>
          </view>
          <view class="text-wrapper_11" catchtap="onRejectTap" data-id="{{item.id}}">
            <text lines="1" class="text_22">拒绝</text>
          </view>
        </view>
      </view>

      <!-- 已审核状态（已通过、已拒绝） -->
      <view class="block_9" wx:else>
        <view class="section_7">
          <view class="box_9">
            <text lines="1" class="text_24">{{item.nickname}}</text>
            <view class="text-wrapper_12 {{item.status}}">
              <text lines="1" class="text_25">{{item.statusText}}</text>
            </view>
          </view>
          <view class="text-wrapper_16">
            <text lines="1" class="text_26">提交时间：</text>
            <text lines="1" class="text_27">{{item.submitTime}}</text>
          </view>
        </view>
        <image class="image_7" src="{{item.coverImg}}" mode="aspectFill" wx:if="{{item.coverImg}}"></image>
        <view class="image_7 placeholder" wx:else></view>
      </view>
    </block>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{!loading && articleList.length === 0}}">
      <text class="empty-text">暂无文章管理数据</text>
    </view>

    <!-- 加载中 -->
    <view class="loading-state" wx:if="{{loading}}">
      <text class="loading-text">加载中...</text>
    </view>
    </view>
  </scroll-view>

  <!-- 编辑弹框 -->
  <view class="modal-overlay" wx:if="{{isEditModalVisible}}" bindtap="hideEditModal"></view>
  <view class="edit-modal" wx:if="{{isEditModalVisible}}">
    <view class="modal-header">
      <text class="modal-title">编辑文章</text>
      <text class="modal-close" bindtap="hideEditModal">×</text>
    </view>
    <view class="modal-content">
      <view class="form-item">
        <text class="form-label">文章标题</text>
        <input 
          class="form-input" 
          type="text" 
          placeholder="请输入文章标题" 
          value="{{editForm.articleTitle}}" 
          data-field="articleTitle" 
          bindinput="onEditInput"
        />
      </view>
      <view class="form-item">
        <text class="form-label">封面图</text>
        <view class="cover-upload-container">
          <image 
            class="cover-preview" 
            src="{{editForm.coverImgUrl}}" 
            mode="aspectFill" 
            wx:if="{{editForm.coverImgUrl}}"
          ></image>
          <view class="cover-placeholder" wx:else>
            <text class="placeholder-text">点击上传封面图</text>
          </view>
          <button class="upload-btn" bindtap="onCoverUploadTap">
            {{editForm.coverImgUrl ? '更换封面' : '上传封面'}}
          </button>
        </view>
      </view>
      <view class="form-item">
        <text class="form-label">文章描述</text>
        <textarea 
          class="form-textarea" 
          placeholder="请输入文章描述" 
          value="{{editForm.description}}" 
          data-field="description" 
          bindinput="onEditInput"
        ></textarea>
      </view>
      <view class="form-item">
        <text class="form-label">文章链接</text>
        <input 
          class="form-input" 
          type="text" 
          placeholder="请输入文章链接" 
          value="{{editForm.articleLink}}" 
          data-field="articleLink" 
          bindinput="onEditInput"
        />
      </view>
    </view>
    <view class="modal-footer">
      <button class="modal-btn cancel-btn" bindtap="hideEditModal">取消</button>
      <button class="modal-btn confirm-btn" bindtap="onSubmitEdit">确定</button>
    </view>
  </view>

  <!-- 审核弹框 -->
  <view class="modal-overlay" wx:if="{{isApprovalModalVisible}}" bindtap="hideApprovalModal"></view>
  <view class="approval-modal" wx:if="{{isApprovalModalVisible}}">
    <view class="modal-header">
      <text class="modal-title">{{approvalAction === 1 ? '通过审核' : '拒绝审核'}}</text>
      <text class="modal-close" bindtap="hideApprovalModal">×</text>
    </view>
    <view class="modal-content">
      <view class="form-item">
        <text class="form-label">审批意见（可选）</text>
        <textarea 
          class="form-textarea" 
          placeholder="请输入审批意见" 
          value="{{approvalForm.appliedDescription}}" 
          data-field="appliedDescription" 
          bindinput="onApprovalInput"
        ></textarea>
      </view>
    </view>
    <view class="modal-footer">
      <button class="modal-btn cancel-btn" bindtap="hideApprovalModal">取消</button>
      <button class="modal-btn confirm-btn" bindtap="submitApproval">确定</button>
    </view>
  </view>
</view>
</custom-nav-bar>