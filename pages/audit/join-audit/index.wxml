<!--pages/audit/join-audit/index.wxml-->
<custom-nav-bar showBack="{{true}}" useAuditStyle="{{true}}" auditTitle="加入审核">
<view class="page">
  <!-- 选择校友会卡片（与校友会审核页 group_5 一致，固定不滚动） -->
  <view class="group_5" wx:if="{{!hasSingleAlumniAssociation && hasAlumniAdminPermission}}">
    <text class="text_14">加入审核</text>
    <text class="label_text">选择校友会</text>
    <view class="text-wrapper_8" bindtap="showAlumniAssociationSelector">
      <text class="text_15">{{selectedAlumniAssociationName || '请选择校友会'}}</text>
    </view>
  </view>

  <!-- 审核列表卡片（与校友会审核页 group_7 一致：固定标题+筛选，仅内部滚动） -->
  <view class="group_7">
    <view class="join-audit-header">
      <text class="text_20">审核列表</text>
    </view>

    <view class="filter-tabs-wrap">
      <view
        class="filter-tab {{applicationStatus === item.value ? 'active' : ''}}"
        wx:for="{{statusList}}"
        wx:key="value"
        data-status="{{item.value}}"
        bindtap="selectStatus"
      >
        {{item.label}}
      </view>
    </view>

    <scroll-view class="scroll-list" scroll-y enable-back-to-top show-scrollbar="{{false}}" bindscrolltolower="loadMore">
      <view wx:if="{{applicationLoading && applicationList.length === 0}}" class="loading-state">
        <text>加载审核列表中...</text>
      </view>
      <view wx:elif="{{!applicationLoading && applicationList.length === 0}}" class="empty-block">
        <text class="empty-text">{{selectedAlumniAssociationId ? '暂无审核数据' : '请先选择校友会'}}</text>
      </view>
      <view wx:else class="application-list">
        <view wx:for="{{applicationList}}" wx:key="applicationId" class="application-item">
          <view class="application-header">
            <view class="applicant-info">
              <image wx:if="{{item.applicantInfo && item.applicantInfo.avatarUrl}}" src="{{item.applicantInfo.avatarUrl}}" class="avatar"></image>
              <view class="info-text">
                <text class="nickname">{{(item.applicantInfo && item.applicantInfo.nickname) || '未知用户'}}</text>
                <text class="apply-time">申请时间：{{item.applyTime}}</text>
              </view>
            </view>
            <view class="status-tag" style="background-color: {{item.applicationStatus === 0 ? '#ffd591' : item.applicationStatus === 1 ? '#b7eb8f' : item.applicationStatus === 2 ? '#ffccc7' : '#d9d9d9'}}">
              {{item.applicationStatusText || (item.applicationStatus === 0 ? '待审核' : item.applicationStatus === 1 ? '已通过' : item.applicationStatus === 2 ? '已拒绝' : '已撤销')}}
            </view>
          </view>
          <view class="application-body">
            <view class="application-item-row">
              <text class="label">校友会：</text>
              <text class="value">{{item.alumniAssociationName || '未知校友会'}}</text>
            </view>
            <view class="application-item-row">
              <text class="label">申请理由：</text>
              <text class="value">{{item.applicationReason || '无'}}</text>
            </view>
          </view>
          <view class="application-footer" wx:if="{{item.applicationStatus === 0}}">
            <button class="review-btn pass-btn" data-application-id="{{item.applicationId}}" bindtap="passApplication">通过</button>
            <button class="review-btn reject-btn" data-application-id="{{item.applicationId}}" bindtap="rejectApplication">拒绝</button>
          </view>
        </view>
      </view>
      <view wx:if="{{applicationLoading && applicationList.length > 0}}" class="loading-more">
        <text>加载更多...</text>
      </view>
      <view wx:if="{{!applicationLoading && !hasMore && applicationList.length > 0}}" class="no-more">
        <text>没有更多数据了</text>
      </view>
    </scroll-view>
  </view>

  <!-- 校友会选择器弹窗 -->
  <view class="alumni-association-picker" wx:if="{{showAlumniAssociationPicker}}">
    <view class="picker-overlay" bindtap="cancelAlumniAssociationSelect"></view>
    <view class="picker-content">
      <view class="picker-header">
        <text class="picker-title">选择校友会</text>
        <text class="picker-cancel" bindtap="cancelAlumniAssociationSelect">取消</text>
      </view>
      <view class="picker-list">
        <view
          class="picker-item"
          wx:for="{{alumniAssociationList}}"
          wx:key="alumniAssociationId"
          data-alumni-association-id="{{item.alumniAssociationId}}"
          data-alumni-association-name="{{item.alumniAssociationName}}"
          bindtap="selectAlumniAssociation"
        >
          <text class="item-name">{{item.alumniAssociationName}}</text>
          <text class="item-check" wx:if="{{selectedAlumniAssociationId == item.alumniAssociationId}}">✓</text>
        </view>
        <view class="picker-empty" wx:if="{{alumniAssociationList.length === 0}}">
          <text>暂无校友会数据</text>
        </view>
      </view>
    </view>
  </view>
</view>
</custom-nav-bar>
