<!--pages/audit/enterprise/index.wxml-->
<!-- 自定义导航栏 -->
<custom-nav-bar title="企业审核" showBack="{{true}}"></custom-nav-bar>

<view class="enterprise-audit-list-page">
  <!-- 校友会选择器 -->
  <view class="form-card" wx:if="{{!hasSingleAlumniAssociation && hasAlumniAdminPermission}}">
    <view class="form-title">企业审核</view>
    
    <!-- 选择校友会 -->
    <view class="form-item">
      <text class="label">选择校友会</text>
      <view class="alumni-association-selector" bindtap="showAlumniAssociationSelector">
        <text class="selector-label">{{selectedAlumniAssociationName || '请选择校友会'}}</text>
        <text class="selector-arrow">▼</text>
      </view>
    </view>
  </view>

  <!-- 企业列表 -->
  <view class="enterprise-list">
    <view 
      class="enterprise-item"
      wx:for="{{enterpriseList}}"
      wx:key="applicationId"
      data-id="{{item.applicationId}}"
    >
      <view class="enterprise-header">
        <view class="enterprise-name">{{item.placeName}}</view>
        <view class="enterprise-status {{item.applicationStatus === 0 ? 'pending' : item.applicationStatus === 1 ? 'approved' : item.applicationStatus === 2 ? 'rejected' : 'canceled'}}">
          {{item.applicationStatus === 0 ? '待审核' : item.applicationStatus === 1 ? '已通过' : item.applicationStatus === 2 ? '已拒绝' : '已撤销'}}
        </view>
      </view>
      <view class="enterprise-info">
        <text class="info-label">负责人：</text>
        <text class="info-value">{{item.applicantName}}</text>
      </view>
      <view class="enterprise-info">
        <text class="info-label">联系电话：</text>
        <text class="info-value">{{item.applicantPhone}}</text>
      </view>
      <view class="enterprise-info">
        <text class="info-label">地址：</text>
        <text class="info-value">{{item.province}}{{item.city}}{{item.district}}{{item.address}}</text>
      </view>
      <view class="enterprise-info">
        <text class="info-label">提交时间：</text>
        <text class="info-value">{{item.createTime}}</text>
      </view>
      
      <!-- 审核操作按钮 -->
      <view class="audit-actions" wx:if="{{item.applicationStatus === 0}}">
        <button class="audit-btn approve-btn" bindtap="approveEnterprise" data-id="{{item.applicationId}}">审核通过</button>
        <button class="audit-btn reject-btn" bindtap="rejectEnterprise" data-id="{{item.applicationId}}">审核拒绝</button>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{!loading && enterpriseList.length === 0}}">
      <text class="empty-text">暂无企业审核数据</text>
    </view>

    <!-- 加载中 -->
    <view class="loading-state" wx:if="{{loading}}">
      <text class="loading-text">加载中...</text>
    </view>
  </view>

  <!-- 校友会选择器弹窗 -->
  <view class="alumni-association-picker" wx:if="{{showAlumniAssociationPicker}}">
    <view class="picker-overlay" bindtap="cancelAlumniAssociationSelect"></view>
    <view class="picker-content">
      <view class="picker-header">
        <text class="picker-title">选择校友会</text>
        <text class="picker-cancel" bindtap="cancelAlumniAssociationSelect">取消</text>
      </view>
      <view class="picker-list">
        <view 
          class="picker-item"
          wx:for="{{alumniAssociationList}}"
          wx:key="alumniAssociationId"
          data-alumni-association-id="{{item.alumniAssociationId}}"
          data-alumni-association-name="{{item.alumniAssociationName}}"
          bindtap="selectAlumniAssociation"
        >
          <text class="item-name">{{item.alumniAssociationName}}</text>
          <text class="item-check" wx:if="{{selectedAlumniAssociationId == item.alumniAssociationId}}">✓</text>
        </view>
        <view class="picker-empty" wx:if="{{alumniAssociationList.length === 0}}">
          <text>暂无校友会数据</text>
        </view>
      </view>
    </view>
  </view>
</view>